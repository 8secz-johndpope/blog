<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Extra FP for RxJS | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="I have read an excellent gentle introduction to reactive programming using RxJS library. The blog post is Getting Started With Rx.js: A Gentle Introduction by Jaime González García and the example is">
<meta name="keywords" content="functional,reactive">
<meta property="og:type" content="article">
<meta property="og:title" content="Extra FP for RxJS">
<meta property="og:url" content="https://glebbahmutov.com/blog/extra-fp-for-rx/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="I have read an excellent gentle introduction to reactive programming using RxJS library. The blog post is Getting Started With Rx.js: A Gentle Introduction by Jaime González García and the example is">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Extra FP for RxJS">
<meta name="twitter:description" content="I have read an excellent gentle introduction to reactive programming using RxJS library. The blog post is Getting Started With Rx.js: A Gentle Introduction by Jaime González García and the example is">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-extra-fp-for-rx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2016-04-14T04:00:00.000Z" itemprop="datePublished">Apr 14 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Extra FP for RxJS
    </h1>

    <h2 class="article-title" itemprop="name">
      Small functional tips for RxJS
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have read an excellent gentle introduction to reactive programming using RxJS library.
The blog post is <a href="http://www.barbarianmeetscoding.com/blog/2016/04/11/getting-started-with-rx-dot-js/" target="_blank" rel="noopener">Getting Started With Rx.js: A Gentle Introduction</a> by
<a href="https://plus.google.com/+JaimeGonz%C3%A1lezGarc%C3%ADa/posts" target="_blank" rel="noopener">Jaime González García</a> and
the example is posted on <a href="https://jsfiddle.net/vintharas/atq1Lpk2/" target="_blank" rel="noopener">jsFiddle</a> for playing around with. 
It is embedded below; click on &quot;Result&quot; tab and click the &quot;load more&quot; button. 
It should load a new random twitter account on each click.</p>
<iframe width="100%" height="300" src="//jsfiddle.net/vintharas/atq1Lpk2/embedded/js,html,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>I liked this article and the example, 
it clearly shows the event processing steps; from clicking on the button to showing
the result (even if I would prefer using something like 
<a href="https://github.com/Matt-Esch/virtual-dom" target="_blank" rel="noopener">virtual-dom</a> to update the page efficiently).</p>
<p>Let us look at the example&#39;s code and see if we can &quot;improve&quot; it a little bit.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> randomPlayer$ = Rx.Observable</span><br><span class="line">  .fromEvent(btnLoadMore, <span class="string">'click'</span>)</span><br><span class="line">  .map( <span class="function"><span class="params">_</span> =&gt;</span> <span class="string">'https://api.github.com/users'</span>)</span><br><span class="line">  .startWith(<span class="string">'https://api.github.com/users'</span>)</span><br><span class="line">  .flatMap(<span class="function"><span class="params">url</span> =&gt;</span> Rx.Observable.fromPromise(fetch(url)))</span><br><span class="line">  .flatMap(<span class="function"><span class="params">r</span> =&gt;</span> Rx.Observable.fromPromise(r.json()))</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>The refactorings I am going to do should serve as learning exercises, and might not be 
needed in this particular case. Yet they fight the whatever little boilerplate code exists 
even in this short program. 
I hate <a href="https://slides.com/bahmutov/remove-the-boilerplate-boscc25" target="_blank" rel="noopener">boilerplate</a>
and always look for ways to shorten and clarify every piece of software I write.</p>
<h2><span id="functions-instead-of-data">Functions instead of data</span></h2><p>First, let us eliminate the duplicate GitHub API urls. We map every button click to the user
list url string, and we also start the stream with the same url. Let us move the url into
its own variable.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">'https://api.github.com/users'</span></span><br><span class="line"><span class="keyword">let</span> randomPlayer$ = Rx.Observable</span><br><span class="line">  .fromEvent(btnLoadMore, <span class="string">'click'</span>)</span><br><span class="line">  .map( <span class="function"><span class="params">_</span> =&gt;</span> url)</span><br><span class="line">  .startWith(url)</span><br><span class="line">  .flatMap(<span class="function"><span class="params">url</span> =&gt;</span> Rx.Observable.fromPromise(fetch(url)))</span><br><span class="line">  .flatMap(<span class="function"><span class="params">r</span> =&gt;</span> Rx.Observable.fromPromise(r.json()))</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>Look at the <code>.map(_ =&gt; url)</code> step - it ignores the input arguments and just returns the same
value every time. Let us create a utility function that just returns the given value when called.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> always = <span class="function"><span class="params">x</span> =&gt;</span> _ =&gt; x</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'https://api.github.com/users'</span></span><br><span class="line"><span class="keyword">let</span> randomPlayer$ = Rx.Observable</span><br><span class="line">  .fromEvent(btnLoadMore, <span class="string">'click'</span>)</span><br><span class="line">  .map(always(url))</span><br><span class="line">  .startWith(url)</span><br><span class="line">  .flatMap(<span class="function"><span class="params">url</span> =&gt;</span> Rx.Observable.fromPromise(fetch(url)))</span><br><span class="line">  .flatMap(<span class="function"><span class="params">r</span> =&gt;</span> Rx.Observable.fromPromise(r.json()))</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>The function <code>always</code> takes an argument value and returns another function. The returned function
does nothing but returns the original value when called. If you do not feel comfortable with
expressing the meaning of <code>always</code> as a one liner (I often feel lost in one liners), write it
down explicitly.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> always = <span class="function"><span class="params">x</span> =&gt;</span> _ =&gt; x</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">always</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using helper <code>always</code> we can replace hardcoded <code>url</code> with clear code - we always map a click to 
the <code>url</code>. We can even refactor <code>always</code> use and &quot;hide&quot; the url inside.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> always = <span class="function"><span class="params">x</span> =&gt;</span> _ =&gt; x</span><br><span class="line"><span class="keyword">const</span> toUrl = always(<span class="string">'https://api.github.com/users'</span>)</span><br><span class="line"><span class="keyword">let</span> randomPlayer$ = Rx.Observable</span><br><span class="line">  .fromEvent(btnLoadMore, <span class="string">'click'</span>)</span><br><span class="line">  .map(toUrl)</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(<span class="function"><span class="params">url</span> =&gt;</span> Rx.Observable.fromPromise(fetch(url)))</span><br><span class="line">  .flatMap(<span class="function"><span class="params">r</span> =&gt;</span> Rx.Observable.fromPromise(r.json()))</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p><code>.map(...)</code> requires a function, thus we give it <code>toUrl</code>, while <code>.startWith(...)</code> needs an
actual value, thus we give it <code>toUrl()</code>.</p>
<p>You can find the updated example at <a href="https://jsfiddle.net/52mwv7gn/1/" target="_blank" rel="noopener">52mwv7gn/1/</a> and below</p>
<iframe width="100%" height="300" src="//jsfiddle.net/52mwv7gn/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>I often return a function to access the data rather than the data in my code. This helps
hide the implementation details as well as protects the data from mutations. For example 
instead of returning a user object and letting the outside code read its properties (and thus
being able to modify the user object) I can return a function that allows reading a particular
property but not setting it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using objects directly</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = ... <span class="comment">// somehow get user</span></span><br><span class="line">  <span class="keyword">return</span> user</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// client code</span></span><br><span class="line"><span class="keyword">var</span> user = getUser()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'user email'</span>, user.email)</span><br><span class="line">user.email = <span class="literal">undefined</span> <span class="comment">// !</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returning a function to limit access to the object</span></span><br><span class="line"><span class="keyword">const</span> prop = <span class="function"><span class="params">o</span> =&gt;</span> name =&gt; o[name]</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prop</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> o[name]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = ... <span class="comment">// somehow get user</span></span><br><span class="line">  <span class="keyword">return</span> prop(user)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// client code</span></span><br><span class="line"><span class="keyword">var</span> user = getUser()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'user email'</span>, user(<span class="string">'email'</span>))</span><br><span class="line"><span class="comment">// user.email = undefined no longer works!</span></span><br><span class="line"><span class="comment">// if internal user object's structure changes, no problem</span></span><br><span class="line"><span class="comment">// we can just return a different function and the</span></span><br><span class="line"><span class="comment">// client code will still work</span></span><br></pre></td></tr></table></figure>
<h2><span id="shorten-promise-boilerplate">Shorten promise boilerplate</span></h2><p>Let us shorten the next two steps - making an Ajax request for data and extracting the JSON
from the response.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.flatMap(<span class="function"><span class="params">url</span> =&gt;</span> Rx.Observable.fromPromise(fetch(url)))</span><br><span class="line">.flatMap(<span class="function"><span class="params">r</span> =&gt;</span> Rx.Observable.fromPromise(r.json()))</span><br></pre></td></tr></table></figure>
<p>Notice that the argument name to both <code>.flatMap</code> calls does not matter, it is only used for
clarity. Thus in reality this code has a very strong boilerplate smell. If we replace the argument
with letter &quot;x&quot; then 45 characters out of 50 in the two lines are the same!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(fetch(x)))</span><br><span class="line">.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(x.json()))</span><br></pre></td></tr></table></figure>
<p>Let us look at the first call&#39;s callback. 
This is the (almost) the simplest function composition example one can find:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x =&gt; Rx.Observable.fromPromise(fetch(x))</span><br><span class="line">     ------------------------- ----- </span><br><span class="line">          f                      g  (x)</span><br></pre></td></tr></table></figure>
<p>Every time we see function <code>f</code> applied to the result of calling another function <code>g</code> to
argument <code>x</code> we can replace <code>f(g(...))</code> with equivalent <em>composed</em> function</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume we have "compose" helper function</span></span><br><span class="line"><span class="keyword">var</span> composed = compose(f, g)</span><br><span class="line">composed(x) <span class="comment">// is same as (f(g(x)))</span></span><br></pre></td></tr></table></figure>
<p>Writing the &quot;compose&quot; helper fuction in this case is very simple - we are ignoring context
and only assume a single argument</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">f, g</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(g(x))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// same as </span></span><br><span class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">f, g</span>) =&gt;</span> x =&gt; f(g(x))</span><br></pre></td></tr></table></figure>
<p>Now let us replace first <code>.flatMap</code> with shorter equivalent code. We can even just provide
the callback without explicit <code>url</code> parameter, achieving 
the <a href="../point-free-programming-is-not-pointless/">pointfree</a> programming style</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajax = compose(Rx.Observable.fromPromise, fetch)</span><br><span class="line">...</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(ajax)</span><br><span class="line">  .flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(x.json()))</span><br></pre></td></tr></table></figure>
<p>You can try the code at <a href="https://jsfiddle.net/h75k3y8z/1/" target="_blank" rel="noopener">jsfiddle.net/h75k3y8z/1/</a> or below</p>
<iframe width="100%" height="300" src="//jsfiddle.net/h75k3y8z/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>Let us simplify the second <code>.flatMap</code> callback. Instead of simple composition <code>f(g(x))</code>
it has a method call on the argument <code>f(x.g())</code>. We need to compose <code>f</code> with invoking a method
on a object. We first know the name of the method <code>json</code> but no the object yet - the object
will be passed to the callback. Let us write simple helper function to invoke a method given
just its name on an object passed later.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> object[name]()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="keyword">const</span> method = <span class="function"><span class="params">name</span> =&gt;</span> object =&gt; object[name]()</span><br><span class="line"><span class="comment">// use like this</span></span><br><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">  email: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">'user@company.com'</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">user.email()   <span class="comment">// 'user@company.com'</span></span><br><span class="line"><span class="keyword">var</span> getEmail = method(<span class="string">'email'</span>)</span><br><span class="line">getEmail(user) <span class="comment">// 'user@company.com'</span></span><br></pre></td></tr></table></figure>
<p><code>method(&#39;email&#39;)</code> just creates a function that is waiting for an actual object. In our RxJS 
example we need a function that will invoke <code>json()</code> on the given response object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(x.json()))</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line">.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(method(<span class="string">'json'</span>)(x)))</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="keyword">const</span> json = method(<span class="string">'json'</span>)</span><br><span class="line">.flatMap(<span class="function"><span class="params">x</span> =&gt;</span> Rx.Observable.fromPromise(json(x)))</span><br></pre></td></tr></table></figure>
<p>Now we have simple function composition again with first function being <code>Rx.Observable.fromPromise</code>
and the second function being <code>json</code> function. Applying compose again makes the callback go away.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajax = compose(Rx.Observable.fromPromise, fetch)</span><br><span class="line"><span class="keyword">const</span> json = compose(Rx.Observable.fromPromise, method(<span class="string">'json'</span>))</span><br><span class="line">...</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(ajax)</span><br><span class="line">  .flatMap(json)</span><br></pre></td></tr></table></figure>
<p>The example still works like before, we just replaced the code with equivalent shorter code</p>
<iframe width="100%" height="300" src="//jsfiddle.net/r09o6ao5/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h2><span id="using-external-library">Using external library</span></h2><p>We have only introduced 3 helper functions above</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> always = <span class="function"><span class="params">x</span> =&gt;</span> _ =&gt; x</span><br><span class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">f, g</span>) =&gt;</span> x =&gt; f(g(x))</span><br><span class="line"><span class="keyword">const</span> method = <span class="function"><span class="params">name</span> =&gt;</span> object =&gt; object[name]()</span><br></pre></td></tr></table></figure>
<p>The functions are so short it is hard to make mistakes in them ;) Yet if you start using little
helper functions like these you immediately will want more of them. You will want more helpers
for different situations (like grabbing the property of an object instead of calling a method),
and more power in each helper (like composing more than two functions or passing arguments
to the method call). Writing these helpers and testing them inside each function quickly 
becomes a chore. Luckily there are entire libraries of these functions, 
<a href="https://lodash.com/docs" target="_blank" rel="noopener">lodash</a> and <a href="http://ramdajs.com/docs/" target="_blank" rel="noopener">Ramda</a> being my favorite.</p>
<p>For the example above, Ramda has everything we need right out of the &quot;box&quot;. Let us add the library
to the fiddle (using CDN) and replace our custom code with Ramda&#39;s functions. The syntax almost
maps one to one, except for <code>method</code> helper - Ramda needs to know the number of arguments
expected by the method, thus we pass <code>0</code> first.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> toUrl = R.always(<span class="string">'https://api.github.com/users'</span>)</span><br><span class="line"><span class="keyword">const</span> ajax = R.compose(Rx.Observable.fromPromise, fetch)</span><br><span class="line"><span class="keyword">const</span> json = R.compose(Rx.Observable.fromPromise, R.invoker(<span class="number">0</span>, <span class="string">'json'</span>))</span><br></pre></td></tr></table></figure>
<p>We run the new code ... and it does not work. The browser console shows an error</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught TypeError: Failed to execute &apos;fetch&apos; on &apos;Window&apos;: parameter 2 (&apos;init&apos;) is not an object.</span><br></pre></td></tr></table></figure>
<p>What is this? Well, <code>R.compose</code> is more powerful than our custom code before; it passes
all arguments along. For example, if we create a little wrapper function to see what arguments
are passed to <code>fetch</code> (which is the new built-in HTML5 API function) we can see those.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajax = R.compose(Rx.Observable.fromPromise, <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line"> <span class="keyword">return</span> fetch(url)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Run the code again and see in the browser console the following</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;https://api.github.com/users&quot;, 1, FlatMapObservable]</span><br></pre></td></tr></table></figure>
<p>Just like <code>Array.map</code>, <code>Observable.flatMap</code> passes to each callback the item, the index and
the &quot;list&quot; (in this case Observable instance) itself. When using arrays, this leads to 
some <a href="http://raganwald.com/2013/01/02/madness.html" target="_blank" rel="noopener">madness</a> 
(and an excellent <a href="../functional-js-interview-question/">interview question</a>).</p>
<p>In our case, <code>fetch</code> gets extra arguments and breaks. But does not <code>fetch</code> only expect a single
argument? After all, if we print <code>fetch.length</code> we get 1! Not really, the 
<a href="https://developers.google.com/web/updates/2015/03/introduction-to-fetch?hl=en" target="_blank" rel="noopener">fetch API</a>
allows additional options object as the second argument</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fetch(url, &#123;  </span><br><span class="line">  credentials: <span class="string">'include'</span>  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Thus <code>fetch</code> is not ignoring the second argument and breaks if the argument is an iteration
index for example. We should really tell <code>fetch</code> to ignore everything but the first argument -
we should make <code>fetch</code> <em>unary</em>. We can write a little helper ourselves easily or use Ramda&#39;s
function</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unary</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> f(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// our unary is same as R.unary</span></span><br><span class="line"><span class="keyword">const</span> ajax = R.compose(Rx.Observable.fromPromise, R.unary(fetch))</span><br></pre></td></tr></table></figure>
<p>Now the code works as expected!</p>
<iframe width="100%" height="300" src="//jsfiddle.net/95ppktb0/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<p>We often have to do this function signature &quot;massaging&quot; when 
<a href="../adapted-point-free-callbacks/">adapting</a> the expected arguments 
to what is really passed into the function.</p>
<h2><span id="compose-promises-instead-of-flap-mapping">Compose promises instead of flap mapping</span></h2><p>We have two chained steps to <code>.flatMap</code> in our stream, and they deal with a single request:
making an ajax request (returns a promise) and then extracting JSON result (also returns a
promise in the new HTML5 API). We can combine the promises using <code>.then()</code> and use a <code>.flatMap</code>
instead.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajaxP = R.unary(fetch)</span><br><span class="line"><span class="keyword">const</span> jsonP = R.invoker(<span class="number">0</span>, <span class="string">'json'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Rx.Observable.fromPromise(</span><br><span class="line">    ajaxP(url).then(jsonP)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(users)</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>Even better, <code>Rx.Observable.flatMap</code> works directly with a promise object, without mapping into
Observable first</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajaxP = R.unary(fetch)</span><br><span class="line"><span class="keyword">const</span> jsonP = R.invoker(<span class="number">0</span>, <span class="string">'json'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ajaxP(url).then(jsonP)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(users)</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>Finally, we have a promise-returning function <code>ajaxP</code> chained to <code>jsonP</code>. The result
of <code>ajaxP</code> is passed to <code>jsonP</code> and then the result is returned (inside the resolved promise).
This is very similar to the function composition, only the passing the result along is 
different. Instad of simplifying <code>f(g(x))</code> into <code>compose(f, g)(x)</code> 
<em>promise composition</em> combines the promise-returning functions using <code>.then</code> method like 
this <code>f(x).then(g) = composeP(f, g)(x)</code></p>
<p>Ramda has promise composition under <a href="http://ramdajs.com/docs/#composeP" target="_blank" rel="noopener">R.composeP</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ajaxP = R.unary(fetch)</span><br><span class="line"><span class="keyword">const</span> jsonP = R.invoker(<span class="number">0</span>, <span class="string">'json'</span>)</span><br><span class="line"><span class="keyword">const</span> users = R.composeP(jsonP, ajaxP)</span><br><span class="line">...</span><br><span class="line">  .startWith(toUrl())</span><br><span class="line">  .flatMap(users)</span><br><span class="line">  .map(pickRandomItem)</span><br></pre></td></tr></table></figure>
<p>The promise composition works from right to left (first ajax, then json). Our original code
was easier to read <em>left to right</em> since it was <code>ajaxP(url).then(jsonP)</code>. There is an equivalent
helper method <a href="http://ramdajs.com/docs/#pipeP" target="_blank" rel="noopener">R.pipeP</a> which is just like <code>compose</code> but expects
its arguments in left to right order. I find it usually easier to read &quot;piped&quot; code
than &quot;composed&quot; code. Both produce the same result</p>
<iframe width="100%" height="300" src="//jsfiddle.net/y8ondcqo/1/embedded/js,result/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

<h2><span id="conclusion">Conclusion</span></h2><p>Functional reactive programming is all about using little helpers to get rid of unnecessary
code in your reactive streams. Writing your own helper functions is a great exercise and a
perfect first step to shorter and clearer code. Then switch to using a dedicated library and
get rid of most of the code in your application.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/extra-fp-for-rx/" data-id="cjpvbjsug00bt44ooff80i9m4" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/extra-fp-for-rx/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/functional/">functional</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/reactive/">reactive</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../is-framework-pure-or-not/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Is framework pure or not?
        
      </div>
    </a>
  
  
    <a href="../not-tested-not-included/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Not tested - not included!</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">106</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">297</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">98</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/">github</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/">graphql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">74</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">82</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/zeit/">zeit</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.67px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.58px;">advice</a> <a href="../tags/angularjs/" style="font-size: 17.92px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.33px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.92px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.42px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.25px;">browser</a> <a href="../tags/ci/" style="font-size: 12.92px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.5px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 16.67px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.83px;">d3</a> <a href="../tags/db/" style="font-size: 14.17px;">db</a> <a href="../tags/docker/" style="font-size: 13.75px;">docker</a> <a href="../tags/es6/" style="font-size: 15px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.33px;">functional</a> <a href="../tags/generators/" style="font-size: 11.67px;">generators</a> <a href="../tags/git/" style="font-size: 14.58px;">git</a> <a href="../tags/github/" style="font-size: 10.42px;">github</a> <a href="../tags/graphql/" style="font-size: 10.83px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.5px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.83px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 12.5px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.67px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.83px;">interview</a> <a href="../tags/jade/" style="font-size: 11.25px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.83px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 17.08px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 18.75px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.83px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.25px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.5px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.42px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 14.58px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.83px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.5px;">security</a> <a href="../tags/sentry/" style="font-size: 13.75px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.08px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.17px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.75px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.42px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.42px;">ui</a> <a href="../tags/vuejs/" style="font-size: 11.25px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.08px;">web workers</a> <a href="../tags/zeit/" style="font-size: 10px;">zeit</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../e2e-testing-graphql-using-cypress/">E2E Testing json-graphql-server using Cypress</a>
          </li>
        
          <li>
            <a href="../functional-middleware/">Functional middleware</a>
          </li>
        
          <li>
            <a href="../hyperapp-state-machine/">Hyperapp state machine web app</a>
          </li>
        
          <li>
            <a href="../element-coverage/">Element coverage for end-to-end tests</a>
          </li>
        
          <li>
            <a href="../use-github-instead-of-npm/">Use GitHub instead of NPM</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/extra-fp-for-rx/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
