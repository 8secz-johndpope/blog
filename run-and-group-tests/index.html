<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Run and group tests the way you want to | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This blog post will show how to get a &amp;quot;typical&amp;quot; CI/CD pipeline set up that is fast yet powerful. The final pipeline will:  runs all tests quickly on CI server using load balancing with --par">
<meta name="keywords" content="testing,cypress">
<meta property="og:type" content="article">
<meta property="og:title" content="Run and group tests the way you want to">
<meta property="og:url" content="https://glebbahmutov.com/blog/run-and-group-tests/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="This blog post will show how to get a &amp;quot;typical&amp;quot; CI/CD pipeline set up that is fast yet powerful. The final pipeline will:  runs all tests quickly on CI server using load balancing with --par">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/add-2-todos.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/app.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/one-machine.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/two-machines.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/split.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/deploy.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/recorded-groups.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/full-pipeline.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/time-error-message.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/time-limit.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/run-and-group/time-limit-setting.png">
<meta property="og:updated_time" content="2018-09-03T14:42:12.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Run and group tests the way you want to">
<meta name="twitter:description" content="This blog post will show how to get a &amp;quot;typical&amp;quot; CI/CD pipeline set up that is fast yet powerful. The final pipeline will:  runs all tests quickly on CI server using load balancing with --par">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/run-and-group/add-2-todos.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-run-and-group-tests" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2018-09-03T04:00:00.000Z" itemprop="datePublished">Sep 3 2018</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Run and group tests the way you want to
    </h1>

    <h2 class="article-title" itemprop="name">
      How to load balance multiple Cypress end-to-end tests in parallel mode, or group different tests together and in general control test runs in any way you want.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This blog post will show how to get a &quot;typical&quot; CI/CD pipeline set up that is fast yet powerful. The final pipeline will:</p>
<ul>
<li>runs all tests quickly on CI server using load balancing with <code>--parallel</code> option</li>
<li>deploys app to the production environment</li>
<li>runs just a few smoke tests against the production url</li>
<li>groups all tests and smoke tests under a single run in Cypress Dashboard for clarity</li>
</ul>
<h2><span id="the-app">The app</span></h2><p>Here is an example TodoMVC test project - <a href="https://github.com/bahmutov/todomvc" target="_blank" rel="noopener">bahmutov/todomvc</a> which is copied from <a href="https://github.com/cypress-io/cypress-example-todomvc" target="_blank" rel="noopener">cypress-io/todomvc</a>. A typical Cypress test that adds two items and verifies that there are two items in the list looks like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cypress/integration/first.js</span></span><br><span class="line">it(<span class="string">'adds 2 todos'</span>, () =&gt; &#123;</span><br><span class="line">  cy.visit(<span class="string">'/'</span>)</span><br><span class="line">  cy.get(<span class="string">'.new-todo'</span>)</span><br><span class="line">    .type(<span class="string">'learn testing&#123;enter&#125;'</span>)</span><br><span class="line">    .type(<span class="string">'be cool&#123;enter&#125;'</span>)</span><br><span class="line">  cy.get(<span class="string">'.todo-list li'</span>)</span><br><span class="line">    .should(<span class="string">'have.length'</span>, <span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>When running Cypress in the interactive mode (<code>cypress open</code>) we can see each command and how the DOM looked during that moment.</p>
<p><img src="/blog/images/run-and-group/add-2-todos.png" alt="First test"></p>
<p>Writing tests with Cypress is easy - and a typical <a href="http://todomvc.com/" target="_blank" rel="noopener">TodoMVC app</a> needs them! Pretty soon I can write tests that exercise all aspects of a typical TodoMVC app - adding and editing items, routing, etc, putting 30 tests into <code>cypress/integration/app.js</code></p>
<p><img src="/blog/images/run-and-group/app.png" alt="All tests"></p>
<h2><span id="running-tests-locally">Running tests locally</span></h2><p>In order to run the tests we need to start the local server. There is NPM script that starts the server - we can call it from one terminal <code>npm start</code> and the server runs at <code>localhost:8888</code>. Cypress knows about this url because I put it in the <code>cypress.json</code> file:</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"baseUrl"</span>: <span class="string">"http://localhost:8888"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Great, but I don&#39;t want to remember to start a server just to run the tests, and I always forget to shut it down after the tests finish. So I use a utility I wrote called <a href="https://github.com/bahmutov/start-server-and-test" target="_blank" rel="noopener">start-server-and-test</a>. It executes &quot;npm start&quot;, waits until port 8888 responds, then runs the &quot;npm test&quot; command - which runs the headless tests. Here are the scripts</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"http-server -p 8888 -c-1 --silent"</span>,</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"cypress run"</span>,</span><br><span class="line">    <span class="attr">"test:ci"</span>: <span class="string">"start-test 8888"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Whenever I want to run all tests headlessly I can execute <code>npm run test:ci</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ npm run test:ci</span><br><span class="line"></span><br><span class="line">&gt; todomvc@1.0.0 test:ci /Users/gleb/git/todomvc</span><br><span class="line">&gt; start-test 8888</span><br><span class="line"></span><br><span class="line">starting server using command &quot;npm run start&quot;</span><br><span class="line">and when url &quot;http://localhost:8888&quot; is responding</span><br><span class="line">running tests using command &quot;test&quot;</span><br><span class="line"></span><br><span class="line">&gt; todomvc@1.0.0 start /Users/gleb/git/todomvc</span><br><span class="line">&gt; http-server -p 8888 -c-1 --silent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; todomvc@1.0.0 test /Users/gleb/git/todomvc</span><br><span class="line">&gt; cypress run</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">==============================================================================</span><br><span class="line"></span><br><span class="line">  (Run Starting)</span><br><span class="line"></span><br><span class="line">  ┌──────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">  │ Cypress:    3.1.0                                                        │</span><br><span class="line">  │ Browser:    Electron 59 (headless)                                       │</span><br><span class="line">  │ Specs:      2 found (app.js, first.js)                                   │</span><br><span class="line">  └──────────────────────────────────────────────────────────────────────────┘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  (Run Finished)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Spec                         Tests  Passing  Failing  Pending  Skipped</span><br><span class="line">  ┌──────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">  │ ✔ app.js              00:31       28       28        -        -        - │</span><br><span class="line">  ├──────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">  │ ✔ first.js            00:01        1        1        -        -        - │</span><br><span class="line">  └──────────────────────────────────────────────────────────────────────────┘</span><br><span class="line">    All specs passed!</span><br></pre></td></tr></table></figure>
<p>That is how I run the tests locally</p>
<h2><span id="running-tests-on-ci">Running tests on CI</span></h2><p>Cypress works great on <a href="https://on.cypress.io/continuous-integration" target="_blank" rel="noopener">any CI</a>. I like <a href="https://circleci.com/" target="_blank" rel="noopener">CircleCI</a> for its simplicity and flexibility, so I set up Circle run for this open source projects and wrote <a href="https://github.com/bahmutov/todomvc/blob/master/circle.yml" target="_blank" rel="noopener">circle.yml</a> file. For now it is just a workflow with a single job that installs dependencies including Cypress binary, then runs the tests. We need to cache <code>~/.npm</code> and <code>~/.cache</code> folders for each build to start quickly. The <code>build</code> job passes all installed files to the <code>test-locally</code> job via <a href="https://circleci.com/blog/deep-diving-into-circleci-workspaces/" target="_blank" rel="noopener">CircleCI workspaces</a>.</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">defaults:</span> <span class="meta">&amp;defaults</span></span><br><span class="line"><span class="attr">  working_directory:</span> <span class="string">~/app</span></span><br><span class="line"><span class="attr">  docker:</span></span><br><span class="line"><span class="attr">    - image:</span> <span class="string">cypress/base:10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line"><span class="attr">  build:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">    steps:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">checkout</span></span><br><span class="line">      <span class="comment"># find compatible cache from previous build,</span></span><br><span class="line">      <span class="comment"># it should have same dependencies installed from package.json checksum</span></span><br><span class="line"><span class="attr">      - restore_cache:</span></span><br><span class="line"><span class="attr">          keys:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">cache-&#123;&#123;</span> <span class="string">.Branch</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">"package.json"</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">      - run:</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line"><span class="attr">          command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">      <span class="comment"># run verify and then save cache.</span></span><br><span class="line">      <span class="comment"># this ensures that the Cypress verified status is cached too</span></span><br><span class="line"><span class="attr">      - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="attr">cy:verify</span></span><br><span class="line">      <span class="comment"># save new cache folder if needed</span></span><br><span class="line"><span class="attr">      - save_cache:</span></span><br><span class="line"><span class="attr">          key:</span> <span class="string">cache-&#123;&#123;</span> <span class="string">.Branch</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">"package.json"</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="attr">          paths:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">~/.npm</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">~/.cache</span></span><br><span class="line">      <span class="comment"># all other test jobs will run AFTER this build job finishes</span></span><br><span class="line">      <span class="comment"># to avoid reinstalling dependencies, we persist the source folder "app"</span></span><br><span class="line">      <span class="comment"># and the Cypress binary to workspace, which is the fastest way</span></span><br><span class="line">      <span class="comment"># for Circle jobs to pass files</span></span><br><span class="line"><span class="attr">      - persist_to_workspace:</span></span><br><span class="line"><span class="attr">          root:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">          paths:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">app</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">.cache/Cypress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">  test-locally:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">    steps:</span></span><br><span class="line">      <span class="comment"># restore application and Cypress binary before running the test command</span></span><br><span class="line"><span class="attr">      - attach_workspace:</span></span><br><span class="line"><span class="attr">          at:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">      - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="attr">test:ci</span></span><br><span class="line"></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line"><span class="attr">  version:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  build_and_test:</span></span><br><span class="line"><span class="attr">    jobs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">build</span></span><br><span class="line"><span class="attr">      - test-locally:</span></span><br><span class="line"><span class="attr">          requires:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">build</span></span><br></pre></td></tr></table></figure>
<p>Great, Circle runs the tests, and they pass ... and I don&#39;t see videos or error screenshots. I need to <a href="http://on.cypress.io/dashboard-service" target="_blank" rel="noopener">set up test recording on Cypress Dashboard</a>. Once I do this, and set <code>CYPRESS_RECORD_KEY</code> environment variable on Circle, I need to change my commands to execute <code>cypress run --record</code>. My full set of scripts becomes larger</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"http-server -p 8888 -c-1 --silent"</span>,</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"cypress run"</span>,</span><br><span class="line">    <span class="attr">"test:ci"</span>: <span class="string">"start-test 8888"</span>,</span><br><span class="line">    <span class="attr">"test:ci:record"</span>: <span class="string">"start-test 8888 cy:record"</span>,</span><br><span class="line">    <span class="attr">"cy:run"</span>: <span class="string">"cypress run"</span>,</span><br><span class="line">    <span class="attr">"cy:record"</span>: <span class="string">"cypress run --record"</span>,</span><br><span class="line">    <span class="attr">"cy:open"</span>: <span class="string">"cypress open"</span>,</span><br><span class="line">    <span class="attr">"cy:verify"</span>: <span class="string">"cypress verify"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And the Circle script command becomes <code>npm run test:ci:record</code>. Great, I can see the video of the run and CLI output at <a href="https://dashboard.cypress.io/#/projects/r9294v/runs/1/specs" target="_blank" rel="noopener">https://dashboard.cypress.io/#/projects/r9294v/runs/1/specs</a>. Hmm, interesting, both tests ran on a single Circle machine.</p>
<p><img src="/blog/images/run-and-group/one-machine.png" alt="Two tests, one machine"></p>
<p>Can we run 2 tests on 2 machines in parallel?</p>
<h2><span id="parallelization">Parallelization</span></h2><p>Recently we have added <a href="https://on.cypress.io/parallelization" target="_blank" rel="noopener">test parallelization</a> to Cypress tests. To load balance all our specs across 2 machines, we need:</p>
<ul>
<li>tell Circle to give us 2 machines. Luckily we just need to set <code>parallelization: 2</code> in <code>circle.yml</code> file like this when we define a job:</li>
</ul>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test-locally:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line">  <span class="comment"># run this job on 2 machines at once</span></span><br><span class="line"><span class="attr">  parallelism:</span> <span class="number">2</span> <span class="comment"># &lt;===== add this line!</span></span><br><span class="line"><span class="attr">  steps:</span></span><br><span class="line">    <span class="comment"># restore application and Cypress binary before running the test command</span></span><br><span class="line"><span class="attr">    - attach_workspace:</span></span><br><span class="line"><span class="attr">        at:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="attr">test:ci:record</span></span><br></pre></td></tr></table></figure>
<ul>
<li>we also need to add flag <code>--parallel</code> to <code>cypress run --record</code> command, so the script command becomes <code>&quot;cy:record&quot;: &quot;cypress run --record --parallel&quot;</code>.</li>
</ul>
<p>You can see the test run at <a href="https://dashboard.cypress.io/#/projects/r9294v/runs/4/specs" target="_blank" rel="noopener">https://dashboard.cypress.io/#/projects/r9294v/runs/4/specs</a> and here is a totally expected thing - the total run is completely dominated by the <code>app.js</code> spec file!</p>
<p><img src="/blog/images/run-and-group/two-machines.png" alt="Two tests on two machines"></p>
<p>The <code>app.js</code> took 34 seconds, while <code>first.js</code> took 1 second. So if we want to load balance these specs, we better split the longer one into smaller spec files, preferably by feature. I split <code>app.js</code> into 6 spec files, each with a few tests. You can find the split in this <a href="https://github.com/bahmutov/todomvc/commit/2133d6684bd5edb8bc07a2a93d22fccb790bb21a" target="_blank" rel="noopener">commit</a>. Let&#39;s push the commit and run the CI again. The Cypress Dashboard shows a much better &quot;balance&quot; of specs!</p>
<p><img src="/blog/images/run-and-group/split.png" alt="Split specs load balanced"></p>
<p>Much better machine utilization. We don&#39;t win any time though, because of the overhead of handling each spec - the test runner needs to contact the Dashboard service, upload video file and other artifacts after each spec and ask for the next spec. When specs finish as quickly as my short example specs, in the order of below 5 seconds, the overhead matters a LOT. In more realistic situations, load balancing across 2, 3, 10 machines is absolutely crucial. And the command <code>cypress run --record --parallel</code> does not care how many machines will be joining - they all will be load balanced automatically.</p>
<h2><span id="deployment">Deployment</span></h2><p>For this static application I picked the simplest deployment - the TodoMVC app is sent to GitHub pages using <a href="https://github.com/tschaub/gh-pages" target="_blank" rel="noopener">gh-pages</a> with NPM script command <code>&quot;deploy&quot;: &quot;gh-pages -d dist&quot;</code>. You can find the deployed version at <a href="https://glebbahmutov.com/todomvc/">https://glebbahmutov.com/todomvc/</a>.</p>
<p>Ok, the deployment is simple to do from the local terminal. What about deploying from CircleCI? Well, when you use workflows, it might be tricky. Here is how to do this, and you can always consult <a href="https://github.com/bahmutov/todomvc/blob/master/circle.yml" target="_blank" rel="noopener">circle.yml</a>.</p>
<p>I will add another job to run after local tests pass.</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  steps:</span></span><br><span class="line"><span class="attr">    - attach_workspace:</span></span><br><span class="line"><span class="attr">        at:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line"><span class="attr">  version:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  build_and_test:</span></span><br><span class="line"><span class="attr">    jobs:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">build</span></span><br><span class="line">      <span class="comment"># runs a couple of machines in parallel</span></span><br><span class="line">      <span class="comment"># with load balanced all tests against a local server</span></span><br><span class="line"><span class="attr">      - test-locally:</span></span><br><span class="line"><span class="attr">          requires:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">build</span></span><br><span class="line">      <span class="comment"># pushes app to https://glebbahmutov.com/todomvc</span></span><br><span class="line"><span class="attr">      - deploy:</span></span><br><span class="line"><span class="attr">          requires:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">test-locally</span></span><br></pre></td></tr></table></figure>
<p>It is also a good idea to only deploy from <code>master</code> branch, which we can control using from the workflow</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the rest of the file</span></span><br><span class="line"><span class="comment"># add "filters + branches" to "deploy" job</span></span><br><span class="line"><span class="attr">- deploy:</span></span><br><span class="line"><span class="attr">    filters:</span></span><br><span class="line"><span class="attr">      branches:</span></span><br><span class="line"><span class="attr">        only:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  requires:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">test-locally</span></span><br></pre></td></tr></table></figure>
<p>Great, all set ...</p>
<p>Except the deployment is NOT happening due to a weird problem 😖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm run deploy</span><br><span class="line"></span><br><span class="line">&gt; todomvc@1.0.0 deploy /root/app</span><br><span class="line">&gt; gh-pages -d dist</span><br><span class="line"></span><br><span class="line">The authenticity of host &apos;github.com (192.30.253.113)&apos; can&apos;t be established.</span><br><span class="line">RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? Step was canceled</span><br></pre></td></tr></table></figure>
<p>The Circle job is hanging, and has to be killed manually. You can tell SSH to trust <code>github.com</code> using a command <code>ssh-keyscan -H github.com &gt;&gt; ~/.ssh/known_hosts</code> <em>except</em> if you add this command to the <code>deploy</code> job it is NOT working.</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  steps:</span></span><br><span class="line">    <span class="comment"># restore application and Cypress binary before running the test command</span></span><br><span class="line"><span class="attr">    - attach_workspace:</span></span><br><span class="line"><span class="attr">        at:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">ssh-keyscan</span> <span class="bullet">-H</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keyscan -H github.com &gt;&gt; ~/.ssh/known_hosts</span><br><span class="line">/bin/bash: /root/.ssh/known_hosts: No such file or directory</span><br></pre></td></tr></table></figure>
<p>Here is the trick - the SSH setup on Circle happens only if the job has <code>checkout</code> step. Thus we need to change the <em>first</em> job in the workflow, the one that checks out source code from GitHub. We also should store <code>~/.ssh</code> folder in the workspace passed from the first job to other jobs in the workflow.</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  steps:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">checkout</span></span><br><span class="line">    <span class="comment"># other NPM commands ...</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">ssh-keyscan</span> <span class="bullet">-H</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line"><span class="attr">    - persist_to_workspace:</span></span><br><span class="line"><span class="attr">        root:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">        paths:</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">app</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">.cache/Cypress</span></span><br><span class="line"><span class="bullet">          -</span> <span class="string">.ssh</span></span><br></pre></td></tr></table></figure>
<p>Great, the pipeline goes through and deploys the <code>dist</code> folder to the GitHub pages.</p>
<p><img src="/blog/images/run-and-group/deploy.png" alt="Deployment"></p>
<h2><span id="tesing-in-production">Tesing in production</span></h2><p>So now that our application is deploying to &quot;production&quot; environment, we should ... test it again. Because who knows - the production application might be misconfigured, missing files, assume a different base url, or something else. We want to make sure the deployment went smoothly. We don&#39;t have to run <em>all</em> end-to-end tests, but we can run just a few sanity tests.</p>
<p>So we want to do two things:</p>
<ul>
<li>run just a single spec file as a smoke test. We can do it using <code>cypress run --spec ...</code> option</li>
<li>run tests against production <code>baseUrl</code>, and not against <code>localhost:8888</code></li>
</ul>
<p>I have added a new script name</p>
<figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts: &#123;</span></span><br><span class="line">    "test:smoke": "CYPRESS_baseUrl=https://glebbahmutov.com/todomvc cypress run --spec cypress/integration/first.js",</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And one last thing - we want to record this test on Cypress dashboard and even add it to the <em>same</em> run as our load balanced job did. Because really, this is part of the same CI workflow execution, so it makes sense to show them together as a single logical run. Except we do NOT want to mix it up with all the tests 2 machines executed in parallel. This is possible - just mark this test as a different group with <code>cypress run --group &lt;name&gt;</code> option.</p>
<figure class="highlight yaml"><figcaption><span>circle.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post-deploy-test:</span></span><br><span class="line">  <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  steps:</span></span><br><span class="line">    <span class="comment"># restore application and Cypress binary before running the test command</span></span><br><span class="line"><span class="attr">    - attach_workspace:</span></span><br><span class="line"><span class="attr">        at:</span> <span class="string">~/</span></span><br><span class="line"><span class="attr">    - run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="attr">test:smoke</span> <span class="bullet">--</span> <span class="bullet">--record</span> <span class="bullet">--group</span> <span class="string">"Smoke test"</span></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line"><span class="attr">  version:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  build_and_test:</span></span><br><span class="line"><span class="attr">    jobs:</span></span><br><span class="line">      <span class="comment"># build, and local tests jobs</span></span><br><span class="line"><span class="attr">      - deploy:</span></span><br><span class="line"><span class="attr">          requires:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">test-locally</span></span><br><span class="line"><span class="attr">      - post-deploy-test:</span></span><br><span class="line"><span class="attr">          requires:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>
<p>The new pipeline finishes, and the Cypress Dashboard run shows two groups of tests - the smoke test with a single spec, and &quot;unnamed&quot; group with all specs (load balanced). You can see this run at <a href="https://dashboard.cypress.io/#/projects/r9294v/runs/18/specs" target="_blank" rel="noopener">https://dashboard.cypress.io/#/projects/r9294v/runs/18/specs</a></p>
<p><img src="/blog/images/run-and-group/recorded-groups.png" alt="All tests and smoke test groups"></p>
<p>Of course we could have given that group a name, because you can combine the two options, like <code>cypress run --parallel --group &quot;all tests&quot;</code>. Read more about options how to group and parallelize test runs in <a href="https://on.cypress.io/parallelization" target="_blank" rel="noopener">Cypress <code>parallelize</code> docs</a>. For now here is the overview of the final CI workflow.</p>
<p><img src="/blog/images/run-and-group/full-pipeline.png" alt="CI workflow"></p>
<h2><span id="wait-for-me">Wait for me</span></h2><p>Our pipeline runs a deploy job between running all tests and running smoke tests. Sometimes the deployment takes a long time. Which means that by the time the smoke tests start, Cypress Dashboard thinks the run has <em>already finished and no new groups should be added</em>.</p>
<p><img src="/blog/images/run-and-group/time-error-message.png" alt="Smoke tests cannot be added to the run"></p>
<p>Every time a group of tests finishes, the Cypress Dashboard starts a countdown, waiting for any new groups to join. Once the countdown gets to zero, the run completes, and no new groups are allowed to join; the run is <em>finished</em>.</p>
<p><img src="/blog/images/run-and-group/time-limit.png" alt="Time limit"></p>
<p>Here are the good news: you can configure the time limit on per project basis. Go the project&#39;s settings in the Dashboard and set a longer time limit.</p>
<p><img src="/blog/images/run-and-group/time-limit-setting.png" alt="Time limit field under project&#39;s settings"></p>
<p>By picking a longer time limit, you can get any pipelines passing, like <a href="../gatsby-netlify-circle-and-cypress/">Netlify + Cypress</a> or <a href="../immutable-deploys-with-data-and-testing/">Zeit + Cypress</a> and see all tests together.</p>
<h2><span id="conclusions">Conclusions</span></h2><ul>
<li>Running E2E tests should be quick and easy. Cypress test runner solved the <code>easy</code> part from its very beginning. Now, with the help of the dashboard service, the <code>quick</code> is really true too.</li>
<li>You can run different tests in groups, and load balance each group separately if needed. All groups are still added to the same logical &quot;run&quot; on the Cypress Dashboard</li>
</ul>
<p>Happy testing, and of course keep reading my <a href="../tags/cypress/">Cypress blog posts here</a> and at the <a href="https://www.cypress.io/blog/" target="_blank" rel="noopener">Cypress official blog</a>!</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/run-and-group-tests/" data-id="cjm76y37x00rdatoovegefiv3" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/run-and-group-tests/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../set-flag-to-start-tests/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Set flag to start tests
        
      </div>
    </a>
  
  
    <a href="../should-i-start-with-cypress/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Should I start with Cypress.io?</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">103</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">292</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">98</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">20</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">67</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/">graphql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">72</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">78</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/zeit/">zeit</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.67px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.58px;">advice</a> <a href="../tags/angularjs/" style="font-size: 17.92px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.33px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.92px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.42px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.25px;">browser</a> <a href="../tags/ci/" style="font-size: 12.92px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.5px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 16.67px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.83px;">d3</a> <a href="../tags/db/" style="font-size: 14.17px;">db</a> <a href="../tags/docker/" style="font-size: 13.75px;">docker</a> <a href="../tags/es6/" style="font-size: 15px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.33px;">functional</a> <a href="../tags/generators/" style="font-size: 11.67px;">generators</a> <a href="../tags/git/" style="font-size: 14.17px;">git</a> <a href="../tags/github/" style="font-size: 10px;">github</a> <a href="../tags/graphql/" style="font-size: 10px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.5px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.83px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 12.08px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.67px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.83px;">interview</a> <a href="../tags/jade/" style="font-size: 11.25px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.83px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 17.08px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 18.75px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.83px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.25px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.5px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.42px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 14.58px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.42px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.5px;">security</a> <a href="../tags/sentry/" style="font-size: 13.75px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.08px;">service workers</a> <a href="../tags/testing/" style="font-size: 19.17px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.75px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.42px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.42px;">ui</a> <a href="../tags/vuejs/" style="font-size: 11.25px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.08px;">web workers</a> <a href="../tags/zeit/" style="font-size: 10px;">zeit</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../js-equality-game/">Solving JS equality game with Cypress test runner</a>
          </li>
        
          <li>
            <a href="../set-flag-to-start-tests/">Set flag to start tests</a>
          </li>
        
          <li>
            <a href="">Run and group tests the way you want to</a>
          </li>
        
          <li>
            <a href="../should-i-start-with-cypress/">Should I start with Cypress.io?</a>
          </li>
        
          <li>
            <a href="../mocking-process-env/">Mocking process.env</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/run-and-group-tests/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
