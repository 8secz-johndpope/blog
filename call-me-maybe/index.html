<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Call me Maybe | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This post is a little addendum to the excellent  Safely Accessing Deeply Nested Values In JavaScript by  A. Sharif. Please read his post first, it has some useful things! In this post I will describe">
<meta name="keywords" content="functional">
<meta property="og:type" content="article">
<meta property="og:title" content="Call me Maybe">
<meta property="og:url" content="https://glebbahmutov.com/blog/call-me-maybe/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="This post is a little addendum to the excellent  Safely Accessing Deeply Nested Values In JavaScript by  A. Sharif. Please read his post first, it has some useful things! In this post I will describe">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Call me Maybe">
<meta name="twitter:description" content="This post is a little addendum to the excellent  Safely Accessing Deeply Nested Values In JavaScript by  A. Sharif. Please read his post first, it has some useful things! In this post I will describe">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- global digital climate strike -->
  <!-- https://digital.globalclimatestrike.net/#website-assets -->
  <script src="https://assets.digitalclimatestrike.net/widget.js" async></script>
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-call-me-maybe" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2017-03-24T04:00:00.000Z" itemprop="datePublished">Mar 24 2017</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Call me Maybe
    </h1>

    <h2 class="article-title" itemprop="name">
      Replacing the built-in OR and TERNARY operators with Maybe monads.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This post is a little addendum to the excellent 
<a href="https://medium.com/javascript-inside/safely-accessing-deeply-nested-values-in-javascript-99bf72a0855a#.r01glupzn" target="_blank" rel="noopener">Safely Accessing Deeply Nested Values In JavaScript</a> by 
<a href="https://twitter.com/sharifsbeat" target="_blank" rel="noopener">A. Sharif</a>. Please read his post first, it has some useful things!</p>
<p>In this post I will describe how I think about the functional code from the <em>user&#39;s perspective</em>.</p>
<h2><span id="the-problem">The Problem</span></h2><p>How do you access nested properties in an object? Let us say we have an object with user comments and we want to get comments for the first post</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = &#123;</span><br><span class="line">  user: &#123;</span><br><span class="line">    posts: [</span><br><span class="line">      &#123; <span class="attr">title</span>: <span class="string">'Foo'</span>, <span class="attr">comments</span>: [ <span class="string">'Good one!'</span>, <span class="string">'Interesting...'</span> ] &#125;,</span><br><span class="line">      &#123; <span class="attr">title</span>: <span class="string">'Bar'</span>, <span class="attr">comments</span>: [ <span class="string">'Ok'</span> ] &#125;,</span><br><span class="line">      &#123; <span class="attr">title</span>: <span class="string">'Baz'</span>, <span class="attr">comments</span>: [] &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(props.user.posts[<span class="number">0</span>].comments)</span><br></pre></td></tr></table></figure>
<p>What happens if a deeply nested property does not exist? The program crashes 
and burns!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(props.users.posts[<span class="number">0</span>].comments)</span><br><span class="line"><span class="comment">// ðŸ”¥ðŸ”¥ðŸ”¥</span></span><br><span class="line"><span class="comment">// it was props.user, not props.users!</span></span><br></pre></td></tr></table></figure>
<h2><span id="manual-solution">Manual solution</span></h2><p>So we need to check at every step if a property exists before accessing it. It gets tedious really 
really quickly. We can write a helpful utility function for safely getting a 
property. Just give this function a path and it will get you the deep value
<em>or a null</em> if the path leads nowhere.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((xs, x) =&gt;</span><br><span class="line">    (xs &amp;&amp; xs[x]) ? xs[x] : null, object)</span><br><span class="line">// safe access</span><br><span class="line">const pathToComments = ['user', 'posts', '0', 'comments']</span><br><span class="line">console.log(<span class="keyword">get</span>(pathToComments, props)) //&gt; ["Good one!","Interesting..."]</span><br><span class="line">console.log(<span class="keyword">get</span>(pathToComments, &#123;&#125;)) <span class="comment">//&gt; null</span></span><br></pre></td></tr></table></figure>
<p><strong>Hint:</strong> I am using <a href="https://github.com/bahmutov/comment-value" target="_blank" rel="noopener">comment-value</a> to embed output values as source comments.</p>
<h3><span id="user-friendly-api-design">User friendly API design</span></h3><p>Notice how user-friendly our function <code>get</code> is because it puts the <code>path</code> argument first and 
<code>object</code> argument second. I always give this advice when designing the order of 
function&#39;s arguments</p>
<blockquote>
<p>Place the argument most likely to be known first on the left</p>
</blockquote>
<p>This advice plays very nicely with the built-in JavaScript 
<a href="../binding-vs-partial-application/">partial application</a> mechanism. 
We are likely to know the <code>path</code> we want to access <em>before</em> we get the actual <code>object</code>.
Thus we can create a nice <em>intermediate</em> function for getting us the nested value in a
particular case.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathToComments = [<span class="string">'user'</span>, <span class="string">'posts'</span>, <span class="string">'0'</span>, <span class="string">'comments'</span>]</span><br><span class="line"><span class="keyword">const</span> firstPostComments = <span class="keyword">get</span>.bind(null, pathToComments)</span><br><span class="line">console.log(firstPostComments(props)) //&gt; ["Good one!","Interesting..."]</span><br><span class="line">console.log(firstPostComments(&#123;&#125;)) <span class="comment">//&gt; null</span></span><br></pre></td></tr></table></figure>
<h3><span id="even-friendlier-api-design">Even friendlier API design</span></h3><p>If we need to use the expression <code>get.bind(null, ...)</code> to create an intermediate access 
function <em>every time we need it</em> we start complaining. And we can complain to the library&#39;s 
authors and have <em>them</em> embed the partial application <em>inside</em> the <code>get</code> function itself. 
JavaScript functions are first class values, so we can easily split
the <code>get</code> definition to accept its two arguments <code>path</code> and <code>object</code> in <em>two calls</em>. The change
is so small with fat arrows functions, I will only show before and after ðŸ˜€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const get = (path, object) =&gt; // before</span><br><span class="line">const get = path =&gt; object =&gt; // after</span><br></pre></td></tr></table></figure>
<p>Tiny change, yet it makes the <em>user&#39;s</em> life so much simpler. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstPostComments = <span class="keyword">get</span>.bind(null, pathToComments) // before</span><br><span class="line">const firstPostComments = <span class="keyword">get</span>(pathToComments) // after</span><br></pre></td></tr></table></figure>
<p>The savings in code length AND readability are now accruing <em>every time</em> someone calls <code>get</code>
to create an intermediate deep access function, while there was no increase in complexity to 
the <code>get</code> code. We could go one step further and curry <code>get</code> using <a href="http://ramdajs.com/docs/#curry" target="_blank" rel="noopener">Ramda.curry</a> function. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;curry&#125; = <span class="built_in">require</span>(<span class="string">'ramda'</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = curry((path, object) =&gt; ...) // just wrap our "<span class="keyword">get</span>" in "curry"</span><br><span class="line">const pathToComments = ['user', 'posts', '0', 'comments']</span><br><span class="line">// if we just know the path, give 1 argument</span><br><span class="line">const firstPostComments = <span class="keyword">get</span>(pathToComments)</span><br><span class="line">console.log(firstPostComments(props)) //&gt; ["Good one!","Interesting..."]</span><br><span class="line">console.log(firstPostComments(&#123;&#125;)) <span class="comment">//&gt; null</span></span><br></pre></td></tr></table></figure>
<p>The benefit of using 3rd party library to curry function, is that we can provide any number
of arguments at once.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// provide both arguments together!</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">get</span>(pathToComments, props)) //&gt; ["Good one!","Interesting..."]</span><br></pre></td></tr></table></figure>
<p>Nice!</p>
<h2><span id="default-value">Default value</span></h2><p>If we have started designing a &quot;get&quot; function to be user-friendly,
we can think about other common use cases. 
For example, what happens if the value is not there? We just return <code>null</code>, which looks bad. 
The user can specify an alternative using built-in JavaScript OR operator <code>||</code>, 
but that again means it has to be done <em>at the caller site</em>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(firstPostComments(props) || <span class="string">'no comment'</span>) <span class="comment">//&gt; ["Good one!","Interesting..."]</span></span><br><span class="line"><span class="built_in">console</span>.log(firstPostComments(&#123;&#125;) || <span class="string">'no comment'</span>) <span class="comment">//&gt; "no comment"</span></span><br></pre></td></tr></table></figure>
<p>We cannot partially apply the built-in OR operator, right? Otherwise we could write something
like (well, if the partial application were done from the right)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ||NoComment = ||.bind(<span class="literal">null</span>, <span class="string">'no comment'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(firstPostComments(props) ||NoComment) <span class="comment">//&gt; ["Good one!","Interesting..."]</span></span><br><span class="line"><span class="built_in">console</span>.log(firstPostComments(&#123;&#125;) ||NoComment) <span class="comment">//&gt; "no comment"</span></span><br></pre></td></tr></table></figure>
<p>But we have to live within the standard JavaScript, so we have to find a way to specify the
default value <em>inside the get</em> function. This is similar to how we added the partial
application inside the function - we have noticed a common client use case and implemented 
it in the function itself by using <code>curry</code>.</p>
<p>We can go several ways about providing the default value. 
The simplest is to let the user specify the default value
right inside the <code>get</code> function. Again we have to think about the signature design. When are
we likely to know the default value to return? Consider the choices derived from the use cases</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">get</span>('no comment', path, object) // 1</span><br><span class="line"><span class="keyword">get</span>(path, 'no comment', object) // 2</span><br><span class="line"><span class="keyword">get</span>(path, object, 'no comment') // 3</span><br></pre></td></tr></table></figure>
<p>If we go with approach <code>// 3</code>, we have to provide the default value <em>after the object</em>, which
means specifying it every time. While flexible, it quickly becomes verbose, and there is no
built-in way to partially apply the <em>right</em> argument (there are library functions we could use
like <a href="http://ramdajs.com/docs/#partialRight" target="_blank" rel="noopener">Ramda.partialRight</a>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(firstPostComments(props, <span class="string">'no comment'</span>)) <span class="comment">//&gt; ["Good one!","Interesting..."]</span></span><br><span class="line"><span class="built_in">console</span>.log(firstPostComments(&#123;&#125;, <span class="string">'no comment'</span>)) <span class="comment">//&gt; "no comment"</span></span><br></pre></td></tr></table></figure>
<p>If we place the default value as the first or second argument in <code>get</code> signature, we can 
easily apply it. To me these two positions seem equivalent. Let us place the default value 
at first position, so the user has to think about &quot;unhappy path&quot; right away.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = curry((defaultValue, path, object) =&gt;</span><br><span class="line">  path.reduce((xs, x) =&gt;</span><br><span class="line">    (xs &amp;&amp; xs[x]) ? xs[x] : defaultValue, object))</span><br><span class="line">const pathToComments = ['user', 'posts', '0', 'comments']</span><br><span class="line">const firstPostComments = <span class="keyword">get</span>('no comment', pathToComments)</span><br><span class="line">console.log(firstPostComments(props)) //&gt; ["Good one!","Interesting..."]</span><br><span class="line">console.log(firstPostComments(&#123;&#125;)) <span class="comment">//&gt; "no comment"</span></span><br></pre></td></tr></table></figure>
<p>Perfect. Yet we now have a question of what the function <code>get</code> does. On one hand it goes through
the object to grab the deeply nested value. 
On the other hand, it also returns the default value if the path does not exist, 
or the resulting value is falsy. This breaks my heuristic for determining when a code fragment
grows too large:</p>
<blockquote>
<p>You have to use words like &quot;AND / OR&quot; to describe what the code does</p>
</blockquote>
<p>In our case, the &quot;OR&quot; functionality can be thought as the second step that runs after the original
<code>get</code> returns a value from an object. Let us write <code>or</code> and use it to return the default value
if the original <code>get</code> (now renamed to <code>_get</code>) returns nothing.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _get = <span class="function">(<span class="params">path, object</span>) =&gt;</span></span><br><span class="line">  path.reduce(<span class="function">(<span class="params">xs, x</span>) =&gt;</span></span><br><span class="line">    (xs &amp;&amp; xs[x]) ? xs[x] : <span class="literal">null</span>, object)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> or = <span class="function">(<span class="params">defaultValue, x</span>) =&gt;</span> x || defaultValue</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = curry((defaultValue, path, object) =&gt; </span><br><span class="line">  or(defaultValue, _get(path, object)))</span><br><span class="line"></span><br><span class="line">const pathToComments = ['user', 'posts', '0', 'comments']</span><br><span class="line">const firstPostComments = <span class="keyword">get</span>('no comment', pathToComments)</span><br><span class="line">console.log(firstPostComments(props)) //&gt; ["Good one!","Interesting..."]</span><br><span class="line">console.log(firstPostComments(&#123;&#125;)) <span class="comment">//&gt; "no comment"</span></span><br></pre></td></tr></table></figure>
<p>When designing <code>or</code> we should follow the same API design philosophy as designing <code>get</code> function.
The typical use cases should determine the order of arguments, and if necessary, the built-in
application. Notice how we place the default value on the left, because we are likely to know 
it early. I am not going to completely rewrite the above <code>or</code>, but that is definitely possible
and would be equivalent to <a href="http://ramdajs.com/docs/#either" target="_blank" rel="noopener">Ramda.either</a> (<a href="http://ramdajs.com/docs/#or" target="_blank" rel="noopener">Ramda.or</a> is meant to cast values
into Booleans).</p>
<h2><span id="executing-code-based-on-returned-value">Executing code based on returned value</span></h2><p>So far, we have grabbed the nested property and printed it. We have even built-in a way to
print default value if the nested property does not exist. What if we want to 
<em>run multiple commands</em> but only if the value exists? Hmm, we now have two problems:</p>
<ol>
<li>It is harder to tell when the property is invalid. Used to be easier: if the returned value is 
 <code>undefined</code> or <code>null</code> then it meant the property is invalid. Now we need to compare to the
 default value, which is trickier.</li>
<li>We have to use JavaScript <code>if (...) { ... }</code> construct, which is NOT composable.</li>
</ol>
<p>Here is an example the explains the point <strong># 2</strong>. Imagine we want to run <code>foo()</code> and <code>bar()</code>
if the property is present. It is easy to do right after the property access.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'in foo'</span>)</span><br><span class="line"><span class="keyword">const</span> bar = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'in bar'</span>)</span><br><span class="line"><span class="keyword">if</span> (firstPostComments(props) !== <span class="string">'no comment'</span>) &#123;</span><br><span class="line">  foo()</span><br><span class="line">  bar()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// in foo</span></span><br><span class="line"><span class="comment">// in bar</span></span><br></pre></td></tr></table></figure>
<p>What if we want to run more functions if there is a property? 
We have to code them right there inside the
<code>if (firstPostComments(props) !== &#39;no comment&#39;) { ... }</code> block. Alternative - return the fetched
property from the code and have the check repeat outside.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'in foo'</span>)</span><br><span class="line"><span class="keyword">const</span> bar = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'in bar'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComments</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> comments = firstPostComments(props)</span><br><span class="line">  <span class="keyword">if</span> (comments !== <span class="string">'no comment'</span>) &#123;</span><br><span class="line">    foo()</span><br><span class="line">    bar()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> comments</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// run another function if there is a comment</span></span><br><span class="line"><span class="keyword">const</span> baz = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'in baz'</span>)</span><br><span class="line"><span class="keyword">if</span> (getComments() !== <span class="string">'no comment'</span>) &#123;</span><br><span class="line">  baz()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// in foo</span></span><br><span class="line"><span class="comment">// in bar</span></span><br><span class="line"><span class="comment">// in baz</span></span><br></pre></td></tr></table></figure>
<p>This code is bad, and we need to solve both problems at once. We need a way to &quot;flag&quot; 
the situation when the original property was invalid to avoid comparing it to 
<code>no comment</code> value everywhere, and we need a way to &quot;queue up&quot; functions to execute 
if the returned property is valid.</p>
<h2><span id="enter-maybe">Enter Maybe</span></h2><p>Let us solve all problems by returning an object of <a href="https://github.com/folktale/data.maybe" target="_blank" rel="noopener">Maybe</a> type instead of
a &quot;plain&quot; value. This object is like a box - it can keep anything inside; the box does not care.
But what it can also do is &quot;know&quot; if the value inside is &quot;valid&quot; or &quot;bad&quot;. We will flag a
value when creating the box (values that are <code>undefined</code> or <code>null</code> are called &quot;nullable&quot; and
that tells the <code>Maybe</code> box that they are &quot;bad&quot; on creation)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Maybe = <span class="built_in">require</span>(<span class="string">'data.maybe'</span>)</span><br><span class="line"><span class="comment">// returns value or "null"</span></span><br><span class="line"><span class="keyword">const</span> _get = <span class="function">(<span class="params">path, object</span>) =&gt;</span></span><br><span class="line">  path.reduce(<span class="function">(<span class="params">xs, x</span>) =&gt;</span></span><br><span class="line">    (xs &amp;&amp; xs[x]) ? xs[x] : <span class="literal">null</span>, object)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = curry((path, object) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = _get(path, object)</span><br><span class="line">  <span class="comment">// put the "value" into a Maybe box</span></span><br><span class="line">  <span class="keyword">return</span> Maybe.fromNullable(value)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The <code>get</code> definition just gets the value and then returns it wrapped in &quot;Maybe&quot; box. We can
shorten this a little bit using equivalent code (or not) depending on the mood.</p>
<p>One thing that we can notice right away is that the value we print are not &quot;simple&quot;.
Instead they are objects that know if the value inside is bad (property <code>#type:Maybe.Nothing</code>) or 
good (same property is <code>Maybe.Just</code>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathToComments = [<span class="string">'user'</span>, <span class="string">'posts'</span>, <span class="string">'0'</span>, <span class="string">'comments'</span>]</span><br><span class="line"><span class="keyword">const</span> firstPostComments = <span class="keyword">get</span>(pathToComments)</span><br><span class="line">console.log(firstPostComments(props)) </span><br><span class="line">    //&gt; &#123;<span class="string">"#type"</span>:<span class="string">"folktale:Maybe.Just"</span>,<span class="string">"value"</span>:[<span class="string">"Good one!"</span>,<span class="string">"Interesting..."</span>]&#125;</span><br><span class="line"><span class="built_in">console</span>.log(firstPostComments(&#123;&#125;)) </span><br><span class="line">    <span class="comment">//&gt; &#123;"#type":"folktale:Maybe.Nothing"&#125;</span></span><br></pre></td></tr></table></figure>
<p>Cool things we can do now: we ca use the response &quot;box&quot; and run new functions 
easily <em>if and only if</em> the value inside is good. 
Printing a good value (and doing nothing for the bad one) is simply:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">firstPostComments(props).map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// [ 'Good one!', 'Interesting...' ]</span></span><br><span class="line">firstPostComments(&#123;&#125;).map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// nothing happens, "console.log" is NOT triggered</span></span><br></pre></td></tr></table></figure>
<p>If we get the comments deep somewhere inside our code, we can simply return the <code>Maybe</code> box
and let the other code do something if the value is good.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getComments</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> firstPostComments(props).map(foo).map(bar)</span><br><span class="line">&#125;</span><br><span class="line">getComments().map(baz)</span><br><span class="line"><span class="comment">// in foo</span></span><br><span class="line"><span class="comment">// in bar</span></span><br><span class="line"><span class="comment">// in baz</span></span><br></pre></td></tr></table></figure>
<p>This is why <a href="https://medium.com/javascript-scene/functors-categories-61e031bac53f#.c4ezycz3n" target="_blank" rel="noopener">people say</a>
that wrapped values (like <code>Maybe</code> monad) are great for composability; because you can compose multiple functions easily using them.</p>
<h2><span id="single-vs-multiple-null-checks">Single vs multiple null checks</span></h2><p>So far we have created a single <code>Maybe</code> after getting the deeply nested property. But if we
look inside the <code>get</code> function we see the <em>same pattern</em> inside the <code>reduce</code> callback</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _get = <span class="function">(<span class="params">path, object</span>) =&gt;</span></span><br><span class="line">  path.reduce(<span class="function">(<span class="params">xs, x</span>) =&gt;</span></span><br><span class="line">    (xs &amp;&amp; xs[x]) ? xs[x] : <span class="literal">null</span>, object)</span><br><span class="line"><span class="comment">// callback (xs, x):</span></span><br><span class="line"><span class="comment">//   if property and value is "good"</span></span><br><span class="line"><span class="comment">//     implicitly run "callback" with next part of the path</span></span><br><span class="line"><span class="comment">//     (implicitly because we are inside Array.reduce)</span></span><br></pre></td></tr></table></figure>
<p>Hmm, this looks like our <code>Maybe</code> box! <code>Maybe.fromNullable</code> puts value in the <code>Maybe</code> box, 
and then lets <code>Maybe</code> decide: if the value is good, calls a function, which constructs another box.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    box.map(xs =&gt; Maybe.fromNullable(xs[property])),</span><br><span class="line">    Maybe.fromNullable(object))</span><br></pre></td></tr></table></figure>
<p>Yet there is a tiny difference, which creates a problem and does not give us a valid result</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pathToComments = [<span class="string">'user'</span>, <span class="string">'posts'</span>, <span class="string">'0'</span>, <span class="string">'comments'</span>]</span><br><span class="line"><span class="keyword">get</span>(pathToComments, props).map(console.log)</span><br><span class="line">// Maybe &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>We have to pass a function to <code>Maybe.map</code> that returns 
<em>not a simple</em> value, but another <code>Maybe</code> box. If we just use <code>map</code> we quickly get into a
situation where boxes are nested inside other boxes, just like a Russian 
<a href="https://en.wikipedia.org/wiki/Matryoshka_doll" target="_blank" rel="noopener">Matryoshka</a> doll.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(Maybe.fromNullable(<span class="string">'foo'</span>)</span><br><span class="line">  .map(<span class="function"><span class="params">()</span> =&gt;</span> Maybe.fromNullable(<span class="string">'bar'</span>))</span><br><span class="line">  .map(<span class="function"><span class="params">()</span> =&gt;</span> Maybe.fromNullable(<span class="string">'baz'</span>)))</span><br><span class="line"><span class="comment">// Maybe &#123; value: Maybe &#123; value: 'baz' &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<p>In our case, the first iteration of <code>get(..., props)</code> fetches &quot;user&quot; value, which returns 
<code>Maybe{ Maybe {...} }</code> and then it tries to fetch &quot;posts&quot;, which does not exist on the 
<code>Maybe</code> itself. Thus it catches it and returns just nothing.</p>
<p>We need to deal with this somehow. We cannot use <code>map</code> because we return an already wrapped
value by checking inside <code>Maybe.fromNullable</code>. 
The wrapped types like <code>Maybe</code> thus implement a <em>separate</em> method to call functions that return
wrapped results. In <code>data.maybe</code> case it is <code>chain</code> - a wrapped value returned from the chained callback
replaces the value in the current box.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(Maybe.fromNullable(<span class="string">'foo'</span>)</span><br><span class="line">  .chain(<span class="function"><span class="params">()</span> =&gt;</span> Maybe.fromNullable(<span class="string">'bar'</span>))</span><br><span class="line">  .chain(<span class="function"><span class="params">()</span> =&gt;</span> Maybe.fromNullable(<span class="string">'baz'</span>)))</span><br><span class="line"><span class="comment">// Maybe &#123; value: 'baz' &#125;</span></span><br></pre></td></tr></table></figure>
<p>Let us replace <code>map</code> with <code>chain</code> inside our <code>get</code> function and all should work out</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    box.chain(xs =&gt; Maybe.fromNullable(xs[property])),</span><br><span class="line">    Maybe.fromNullable(object))</span><br><span class="line">const pathToComments = ['user', 'posts', '0', 'comments']</span><br><span class="line"><span class="keyword">get</span>(pathToComments, props).map(console.log)</span><br><span class="line">// [ 'Good one!', 'Interesting...' ]</span><br><span class="line"><span class="keyword">get</span>(pathToComments, &#123;&#125;).map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// nothing happens, "console.log" is NOT called</span></span><br><span class="line"><span class="keyword">get</span>(pathToComments).map(console.log)</span><br><span class="line">// nothing happens, "console.log" is NOT called</span><br></pre></td></tr></table></figure>
<h2><span id="composing-chains">Composing chains</span></h2><p>Notice how we have replaced a ternary operator <code>(xs &amp;&amp; xs[x]) ? xs[x] : null</code> inside the <code>reduce</code>
callback (and the outside <code>Maybe.fromNullable</code>) with a <code>Maybe.chain()</code> function? Nice!
Having a function call instead of the built-in JavaScript ternary operator allows us to 
simplify it (just like we simplified code when we replaced built-in <code>||</code> operator).</p>
<p>I am going to simplify <code>get</code> in several steps for clarity. Let us first replace <code>box.chain</code> with
<a href="http://ramdajs.com/docs/#chain" target="_blank" rel="noopener">Ramda.chain</a> called on a <code>box</code>. It is a good idea to write a few unit tests before
refactoring code like this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    box.chain(xs =&gt; Maybe.fromNullable(xs[property])),</span><br><span class="line">    Maybe.fromNullable(object))</span><br><span class="line">// after</span><br><span class="line">const <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    R.chain(xs =&gt; Maybe.fromNullable(xs[property]), box),</span><br><span class="line">    Maybe.fromNullable(object))</span><br></pre></td></tr></table></figure>
<p>Second, let us use a function call to get a property of an object, rather than using built-in
<code>object[name]</code> syntax. In our case, we can use <a href="http://ramdajs.com/docs/#prop" target="_blank" rel="noopener">Ramda.prop</a> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// use Ramda.prop instead of xs[property]</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    R.chain(xs =&gt; Maybe.fromNullable(R.prop(property, xs)), box),</span><br><span class="line">    Maybe.fromNullable(object))</span><br></pre></td></tr></table></figure>
<p>Then we can abstract nested function calls <code>Maybe.fromNullable(R.prop(property, xs)</code> 
into its own function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extract safe property access</span></span><br><span class="line"><span class="keyword">const</span> safeProp = R.curry(<span class="function">(<span class="params">property, xs</span>) =&gt;</span> </span><br><span class="line">  Maybe.fromNullable(R.prop(property, xs)))</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">get</span> = (path, object) =&gt;</span><br><span class="line">  path.reduce((box, property) =&gt;</span><br><span class="line">    R.chain(safeProp(property), box),</span><br><span class="line">    Maybe.fromNullable(object))</span><br></pre></td></tr></table></figure>
<p>Hmm, if we have <code>safeProp</code>, maybe we do not need to always use <code>get</code>. In a simple case, like
grabbing a value a few levels deep, we can just chain it ourselves.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Maybe.fromNullable(props)</span><br><span class="line">  .chain(safeProp(<span class="string">'user'</span>))</span><br><span class="line">  .chain(safeProp(<span class="string">'posts'</span>))</span><br><span class="line">  .chain(safeProp(<span class="string">'0'</span>))</span><br><span class="line">  .chain(safeProp(<span class="string">'comments'</span>))</span><br><span class="line">  .map(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure>
<p>Looks awful ðŸ¤”</p>
<p>Luckily, there is utility methods for composing wrapped values that have chain interface.
In Ramda it is <a href="http://ramdajs.com/docs/#composeK" target="_blank" rel="noopener">composeK</a> and <a href="http://ramdajs.com/docs/#pipeK" target="_blank" rel="noopener">pipeK</a> functions. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getComments = R.pipeK(</span><br><span class="line">  safeProp(<span class="string">'user'</span>),</span><br><span class="line">  safeProp(<span class="string">'posts'</span>),</span><br><span class="line">  safeProp(<span class="string">'0'</span>),</span><br><span class="line">  safeProp(<span class="string">'comments'</span>)</span><br><span class="line">)</span><br><span class="line">getComments(props).map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// [ 'Good one!', 'Interesting...' ]</span></span><br><span class="line">getComments(&#123;&#125;).map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// nothing is done, "console.log" is NOT triggered</span></span><br><span class="line">getComments().map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// crashes and burns, because we are not protecting </span></span><br><span class="line"><span class="comment">// against the very FIRST access</span></span><br></pre></td></tr></table></figure>
<p>In order to protect against the missing or undefined first value, just put the protection
function first. It is that easy with functional programming.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getComments = R.pipeK(</span><br><span class="line">  Maybe.fromNullable,</span><br><span class="line">  safeProp(<span class="string">'user'</span>),</span><br><span class="line">  safeProp(<span class="string">'posts'</span>),</span><br><span class="line">  safeProp(<span class="string">'0'</span>),</span><br><span class="line">  safeProp(<span class="string">'comments'</span>)</span><br><span class="line">)</span><br><span class="line">getComments().map(<span class="built_in">console</span>.log)</span><br><span class="line"><span class="comment">// nothing is done, "console.log" is NOT triggered</span></span><br></pre></td></tr></table></figure>
<p>Safe and sound.</p>
<h2><span id="extra-info">Extra info</span></h2><ul>
<li><a href="../user-friendly-api/">User friendly API</a></li>
<li><a href="../if-else-vs-either-monad-vs-frp/">If Else vs Either Monad vs FRP</a></li>
<li><a href="https://github.com/xgrommx/awesome-functional-programming" target="_blank" rel="noopener">List of awesome functional resources</a></li>
<li><a href="../put-callback-first-for-elegance/">Put callback first for elegance</a></li>
</ul>
<p>if there is another resource that might be helpful, leave a comment.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/call-me-maybe/" data-id="ck215o5g401ffiuooaxy8i8xs" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/call-me-maybe/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/functional/">functional</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../web-packing-the-internet/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Web Packing the Internet
        
      </div>
    </a>
  
  
    <a href="../asking-coworkers/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Asking coworkers to decide my career</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">116</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">319</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/">a11y</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">100</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/">climate</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">47</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/">github</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/">graphql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">161</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">79</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">99</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/zeit/">zeit</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.67px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10px;">a11y</a> <a href="../tags/advice/" style="font-size: 19.58px;">advice</a> <a href="../tags/angularjs/" style="font-size: 17.92px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.33px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.92px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.42px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.25px;">browser</a> <a href="../tags/ci/" style="font-size: 13.33px;">ci</a> <a href="../tags/climate/" style="font-size: 10.42px;">climate</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.5px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 17.5px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.83px;">d3</a> <a href="../tags/db/" style="font-size: 14.17px;">db</a> <a href="../tags/docker/" style="font-size: 14.17px;">docker</a> <a href="../tags/es6/" style="font-size: 15px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.33px;">functional</a> <a href="../tags/generators/" style="font-size: 11.67px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 11.25px;">github</a> <a href="../tags/graphql/" style="font-size: 10.83px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.5px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.83px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 12.5px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.67px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.83px;">interview</a> <a href="../tags/jade/" style="font-size: 11.25px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.83px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 16.67px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 18.75px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.83px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.25px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.08px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.42px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 10px;">react</a> <a href="../tags/reactive/" style="font-size: 14.58px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.83px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.5px;">security</a> <a href="../tags/sentry/" style="font-size: 13.75px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.08px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.17px;">testing</a> <a href="../tags/tutorial/" style="font-size: 14.17px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.67px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.42px;">ui</a> <a href="../tags/vuejs/" style="font-size: 11.25px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.08px;">web workers</a> <a href="../tags/zeit/" style="font-size: 12.08px;">zeit</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../cambridge-elections/">Cambridge MA elections</a>
          </li>
        
          <li>
            <a href="../testing-angular-application-via-app-actions/">Testing Angular application via App Actions</a>
          </li>
        
          <li>
            <a href="../visual-diffing-for-CLI-apps/">Visual diffing flow for your pretty CLI applications</a>
          </li>
        
          <li>
            <a href="../configure-prettier-in-vscode/">How to configure Prettier and VSCode</a>
          </li>
        
          <li>
            <a href="../cypress-using-child-window/">Cypress using child window</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/call-me-maybe/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
