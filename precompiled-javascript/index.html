<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Precompiled JavaScript | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="You can use a lot of ES6 features today. Most of the features are already implemented in Node 4, 5 and even 0.12. You can  precisely transpile the missing features when the client installs your module">
<meta name="keywords" content="javascript">
<meta property="og:type" content="article">
<meta property="og:title" content="Precompiled JavaScript">
<meta property="og:url" content="https://glebbahmutov.com/blog/precompiled-javascript/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="You can use a lot of ES6 features today. Most of the features are already implemented in Node 4, 5 and even 0.12. You can  precisely transpile the missing features when the client installs your module">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Precompiled JavaScript">
<meta name="twitter:description" content="You can use a lot of ES6 features today. Most of the features are already implemented in Node 4, 5 and even 0.12. You can  precisely transpile the missing features when the client installs your module">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-precompiled-javascript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2016-01-20T05:00:00.000Z" itemprop="datePublished">Jan 20 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Precompiled JavaScript
    </h1>

    <h2 class="article-title" itemprop="name">
      How to use ES6 and target older NodeJS platforms without mangling the code to the lowest common denominator
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You can use a lot of ES6 features today.
Most of the features are already implemented in Node 4, 5 and even 0.12. You can 
precisely transpile the missing features when the client installs your module,
see my blog post 
<a href="../javascript-needs-compile-step/">JavaScript needs the compile step (on install)</a>. 
The ES6 features already supported by the client are unchanged, 
and only the missing features are transpiled.</p>
<p>There was a lot of feedback to the blog post and the example implementation, ranging
from &quot;No way, don&#39;t do this&quot; to &quot;Wow, this is the way JavaScript should be written in 2016&quot;.
A lot of people pointed the major shortcoming of the proposed method: it adds a LOT of
weight to the NPM install - the client has to download Babel and its plugins in order to
transpile! </p>
<p>I wanted a better solution.</p>
<h2><span id="pre-compiled-javascript">Pre-compiled JavaScript</span></h2><p>Here is an alternate solution. The range of NodeJS versions in the wild is pretty small. The
most popular are 0.10, 0.12, and the newer versions 4 and 5. We can <em>pre-build</em> a
single bundle for each of these versions during the build step (on the dev or CI machine).
During the installation by the client, we can determine which bundle to use depending
on the Node version.</p>
<p>This obviously increases the NPM download size, but the increase is only in the source code
size, and not in any additional module downloads.</p>
<p>I wrote <a href="https://github.com/bahmutov/pre-compiled" target="_blank" rel="noopener">pre-compiled</a> tool for the devs. The tool
uses <a href="https://github.com/bahmutov/compiled" target="_blank" rel="noopener">compiled</a> to bundle (using Rollup) and transpile
the produced code for different Node platforms. I have collected the ES features available by
default (without <code>--harmony</code> flag) on each platform, see 
<a href="https://github.com/bahmutov/pre-compiled/tree/master/features" target="_blank" rel="noopener">features files</a>. I still test
the source code to see which ES features it actually uses to minimize transpile times and avoid
transpiling a feature the platform already supports.</p>
<h2><span id="example">Example</span></h2><p>Here is an example how one could use this approach in practice. I have created 
<a href="https://github.com/bahmutov/precompiled-example" target="_blank" rel="noopener">precompiled-example</a> repo with a few source
files. It uses my favorite ES6 features, for example template literals and 
object parameter shorthand notation</p>
<figure class="highlight js"><figcaption><span>src/main.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'./calc'</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve(add(a, b))</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">sum</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;a&#125;</span> + <span class="subst">$&#123;b&#125;</span> = <span class="subst">$&#123;sum&#125;</span>`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="keyword">const</span> objectAdd = <span class="function">(<span class="params">&#123;a, b&#125;</span>) =&gt;</span> a + b</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Adding object properties'</span>, objectAdd(&#123; <span class="attr">a</span>: <span class="number">10</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;))</span><br></pre></td></tr></table></figure>
<p>It uses ES6 module <code>import</code> of course to allow efficient tree-shaking when producing the
output bundle.</p>
<p>First, install the <a href="https://github.com/bahmutov/pre-compiled" target="_blank" rel="noopener">pre-compiled</a> build tool</p>
<pre><code>npm install --save-dev pre-compiled
</code></pre><p>Create the build step</p>
<figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "build": "precompile"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We need to tell <code>pre-compiled</code> tool which files to start with and where to output them. 
Add a <code>config</code> object to the <code>package.json</code> file</p>
<figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "build": "precompile"</span><br><span class="line">&#125;,</span><br><span class="line">"config": &#123;</span><br><span class="line">    "pre-compiled": &#123;</span><br><span class="line">        "dir": "dist",</span><br><span class="line">        "files": ["src/main.js"]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>precompile</code> step will start with <code>src/main.js</code> file and will roll all ES6 &#39;imported&#39; modules
into one bundle, producing <code>dist/main.js</code> bundle. Then it will produce several bundles 
(you can control this list via config option, of course)</p>
<pre><code>dist/main.compiled.for.0.10.js
dist/main.compiled.for.0.11.js
dist/main.compiled.for.0.12.js
dist/main.compiled.for.4.js
dist/main.compiled.for.5.js
</code></pre><p>We should add these bundles to the list of files included in our 
<a href="../smaller-published-NPM-modules/">NPM package</a></p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"files"</span>: [<span class="string">"dist"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Second, we need to add a production dependency that will run <em>on the client during install</em>.</p>
<pre><code>npm install --save pick-precompiled
</code></pre><p>And we need to call it during <code>postinstall</code> step</p>
<figure class="highlight"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "build": "precompile",</span><br><span class="line">    "postinstall": "pick-precompiled"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We have multiple bundles, and at install one of them will be picked and copied to <code>dist/main.js</code>
(according to the output directory and the original bundle name). Thus we should also set
the main script to point at the bundle, even if it does not exist yet.</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"main"</span>: <span class="string">"dist/main.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="picking-bundle-in-action">Picking bundle in action</span></h2><p>I have made a <a href="https://github.com/bahmutov/precompiled-example" target="_blank" rel="noopener">precompiled-example</a> module to
show the bundling and picking the right bundle in action.</p>
<p>If we do <code>npm install precompiled-example</code> we get the following output</p>
<pre><code>node version 0.12.9
for node version 0.12.9 picked bundle dist/main.compiled.for.0.12.js
copied bundle dist/main.js
</code></pre><p>Our bundle has a lot of transpiled features and it works</p>
<pre><code>$ node node_modules/precompiled-example/
Adding object properties 12
binary literal 5
object foo and bar
10 + 2 = 12
</code></pre><p>We can inspect the bundle, notice the transpiled features for Node 0.12</p>
<pre><code>$ cat node_modules/precompiled-example/dist/main.js
&apos;use strict&apos;;
require(&apos;pick-precompiled&apos;).babelPolyfill()
var add = function (a, b) {
  return a + b;
};
var a = 10;
var b = 2;
Promise.resolve(add(a, b)).then(function (sum) {
  console.log(a + &apos; + &apos; + b + &apos; = &apos; + sum);
});
var objectAdd = function (_ref) {
  var a = _ref.a;
  var b = _ref.b;
  return a + b;
};
console.log(&apos;Adding object properties&apos;, objectAdd({ a: 10, b: 2 }));
...
</code></pre><p>Let us try installing from Node 4.</p>
<pre><code>$ nvm use 4
Now using node v4.2.2 (npm v3.5.0)
for node version 4.2.2 picked bundle dist/main.compiled.for.4.js
copied bundle dist/main.js
$ node node_modules/precompiled-example/
Adding object properties 12
binary literal 5
object foo and bar
10 + 2 = 12
</code></pre><p>Same working module, but the code now runs without transpiled parts, Node 4 supports
almost all features we needed (arrows, template literals)</p>
<pre><code>$ cat node_modules/precompiled-example/dist/main.js
&apos;use strict&apos;;
require(&apos;pick-precompiled&apos;).babelPolyfill()
const add = (a, b) =&gt; a + b;
const a = 10;
const b = 2;
Promise.resolve(add(a, b)).then(function (sum) {
  console.log(`${ a } + ${ b } = ${ sum }`);
});
const objectAdd = _ref =&gt; {
  let a = _ref.a;
  let b = _ref.b;
  return a + b;
};
console.log(&apos;Adding object properties&apos;, objectAdd({ a: 10, b: 2 }));
</code></pre><p>Finally, let us see if Node 0.10 is working.</p>
<pre><code>$ nvm use 0.10
Now using node v0.10.40 (npm v1.4.28)
$ npm install precompiled-example
for node version 0.10.40 picked bundle dist/main.compiled.for.0.10.js
$ node node_modules/precompiled-example/
Adding object properties 12
binary literal 5
object foo and bar
10 + 2 = 12
</code></pre><p>Nice! We do have a nice bundle for each case.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>With this approach you can admit that your NPM module is <strong>pre-rolled and pre-compiled</strong> :)</p>
<p>There are shortcomings - building and including several bundles instead of one, changing Node
version using <code>nvm</code> requires <code>npm install</code> call. But overall I like this approach because the
bundles installed have nice, clean source.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/precompiled-javascript/" data-id="cjgkuytht00m6oloocpo098ut" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/precompiled-javascript/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../difference-between-promise-and-task/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Difference between a Promise and a Task
        
      </div>
    </a>
  
  
    <a href="../javascript-needs-compile-step/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">JavaScript needs the compile step (on install)</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">102</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">281</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">98</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">67</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">71</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">73</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.74px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.57px;">advice</a> <a href="../tags/angularjs/" style="font-size: 17.83px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.48px;">assertions</a> <a href="../tags/ast/" style="font-size: 13.04px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.65px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.52px;">browser</a> <a href="../tags/ci/" style="font-size: 12.61px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.61px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 14.35px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.87px;">d3</a> <a href="../tags/db/" style="font-size: 14.35px;">db</a> <a href="../tags/docker/" style="font-size: 13.48px;">docker</a> <a href="../tags/es6/" style="font-size: 15.22px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.26px;">functional</a> <a href="../tags/generators/" style="font-size: 11.74px;">generators</a> <a href="../tags/git/" style="font-size: 14.35px;">git</a> <a href="../tags/grunt/" style="font-size: 12.61px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.87px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 11.74px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.3px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.87px;">interview</a> <a href="../tags/jade/" style="font-size: 11.3px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.87px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 16.96px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 18.7px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.09px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.3px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.39px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.43px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 14.78px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.43px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.61px;">security</a> <a href="../tags/sentry/" style="font-size: 13.91px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.17px;">service workers</a> <a href="../tags/testing/" style="font-size: 19.13px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.04px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.43px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.43px;">ui</a> <a href="../tags/vuejs/" style="font-size: 11.3px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.17px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../trying-out-redis/">Trying Redis</a>
          </li>
        
          <li>
            <a href="../vuepress-conditional-testing/">VuePress and some Cypress end-to-end testing tips</a>
          </li>
        
          <li>
            <a href="../lock-down-sinon-stub/">Lock Down Sinon Stub</a>
          </li>
        
          <li>
            <a href="../how-i-organize-readme/">How I Organize README</a>
          </li>
        
          <li>
            <a href="../renovate-app/">Painless Dependency Upgrades with Renovate App</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/precompiled-javascript/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
