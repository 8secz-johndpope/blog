<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing a chart with Cypress and Applitools | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Note: you can find the source code for this blog post at github.com/bahmutov/chart-testing-example. ChartsI have found a great JavaScript library for creating SVG charts github.com/frappe/charts with">
<meta name="keywords" content="testing,cypress">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing a chart with Cypress and Applitools">
<meta property="og:url" content="https://glebbahmutov.com/blog/testing-a-chart/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Note: you can find the source code for this blog post at github.com/bahmutov/chart-testing-example. ChartsI have found a great JavaScript library for creating SVG charts github.com/frappe/charts with">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/chart.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/first-test.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/wait-for-rectangles.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/before-each.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/events.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/tooltip.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/seasons.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/chart-data.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/applitools-API-key.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/applitools-batch.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/ci-visual-diff-error.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/visual-diff.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/diff.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/highlight-diff.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/visual-diff-root-cause-analysis.png">
<meta property="og:updated_time" content="2019-03-28T21:13:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Testing a chart with Cypress and Applitools">
<meta name="twitter:description" content="Note: you can find the source code for this blog post at github.com/bahmutov/chart-testing-example. ChartsI have found a great JavaScript library for creating SVG charts github.com/frappe/charts with">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/testing-a-chart/chart.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <!-- global digital climate strike -->
  <!-- https://digital.globalclimatestrike.net/#website-assets -->
  <script src="https://assets.digitalclimatestrike.net/widget.js" async></script>
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-testing-a-chart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2019-03-28T04:00:00.000Z" itemprop="datePublished">Mar 28 2019</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing a chart with Cypress and Applitools
    </h1>

    <h2 class="article-title" itemprop="name">
      End-to-end testing an SVG chart using Cypress.io test runner and image diffing Applitools plugin.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>Note:</strong> you can find the source code for this blog post at <a href="https://github.com/bahmutov/chart-testing-example" target="_blank" rel="noopener">github.com/bahmutov/chart-testing-example</a>.</p>
<h2><span id="charts">Charts</span></h2><p>I have found a great JavaScript library for creating SVG charts <a href="https://github.com/frappe/charts" target="_blank" rel="noopener">github.com/frappe/charts</a> with a demo website at <a href="https://frappe.io/charts" target="_blank" rel="noopener">https://frappe.io/charts</a>. Creating a chart is as simple as including a single script tag and writing a little snippet like</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"chart"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/frappe-charts@1.1.0/dist/frappe-charts.min.iife.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  labels: [<span class="string">'winter'</span>, <span class="string">'spring'</span>, <span class="string">'summer'</span>, <span class="string">'fall'</span>],</span><br><span class="line">  datasets: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'Sunny days'</span>,</span><br><span class="line">      type: <span class="string">'bar'</span>,</span><br><span class="line">      values: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">25</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> chart = <span class="keyword">new</span> frappe.Chart(<span class="string">'#chart'</span>, &#123;</span><br><span class="line">  title: <span class="string">'Sunny days per year'</span>,</span><br><span class="line">  data: data,</span><br><span class="line">  type: <span class="string">'bar'</span>,</span><br><span class="line">  height: <span class="number">250</span>,</span><br><span class="line">  colors: [<span class="string">'#7cd6fd'</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>which produces a bar chart like this:</p>
<p><img src="/blog/images/testing-a-chart/chart.png" alt="Bar chart with tooltip on hover"></p>
<p>Great, but how do I actually test this chart? How do I ensure that I accidentally do not break my code when upgrading from <a href="mailto:`frappe-charts@1.1.0" target="_blank" rel="noopener">`frappe-charts@1.1.0</a><code>to</code><a href="mailto:frappe-charts@1.2.0" target="_blank" rel="noopener">frappe-charts@1.2.0</a>`?</p>
<h2><span id="functional-tests">Functional tests</span></h2><p>First, let&#39;s start testing this SVG chart using <a href="https://www.cypress.io" target="_blank" rel="noopener">Cypress.io</a> test runner. I will install <code>cypress</code>, <code>parcel-bundler</code> (to server local site) and <a href="https://github.com/bahmutov/start-server-and-test" target="_blank" rel="noopener">start-server-and-test</a> (for starting the server and the tests).</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"parcel server index.html"</span>,</span><br><span class="line">    <span class="attr">"cy:open"</span>: <span class="string">"cypress open"</span>,</span><br><span class="line">    <span class="attr">"dev"</span>: <span class="string">"start-test 1234 cy:open"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"cypress"</span>: <span class="string">"3.2.0"</span>,</span><br><span class="line">    <span class="attr">"parcel-bundler"</span>: <span class="string">"1.12.3"</span>,</span><br><span class="line">    <span class="attr">"start-server-and-test"</span>: <span class="string">"1.7.12"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The first test should load the site and assure that the chart is visible</p>
<figure class="highlight js"><figcaption><span>cypress/integration/first-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types="Cypress" /&gt;</span></span><br><span class="line">it(<span class="string">'shows bar chart'</span>, () =&gt; &#123;</span><br><span class="line">  cy.visit(<span class="string">'localhost:1234'</span>)</span><br><span class="line">  cy.get(<span class="string">'.frappe-chart'</span>)</span><br><span class="line">    .should(<span class="string">'be.visible'</span>)</span><br><span class="line">    .and(<span class="function"><span class="params">chart</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// we can assert anything about the chart really</span></span><br><span class="line">      expect(chart.height()).to.be.greaterThan(<span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>We can start Cypress GUI with <code>npm run dev</code> and see the first test pass</p>
<p><img src="/blog/images/testing-a-chart/first-test.gif" alt="First passing test"></p>
<p>Do you see delayed data load with animation? It happens <em>after</em> the test has already finished. I would like my test to only finish when all 4 bars are rendered, so I will change my test to find the four SVG rectangles.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/first-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types="Cypress" /&gt;</span></span><br><span class="line">it(<span class="string">'shows bar chart'</span>, () =&gt; &#123;</span><br><span class="line">  cy.visit(<span class="string">'localhost:1234'</span>)</span><br><span class="line">  cy.get(<span class="string">'.frappe-chart'</span>)</span><br><span class="line">    .should(<span class="string">'be.visible'</span>)</span><br><span class="line">    .and(<span class="function"><span class="params">chart</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// we can assert anything about the chart really</span></span><br><span class="line">      expect(chart.height()).to.be.greaterThan(<span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// let the chart load by observing the rendered bars</span></span><br><span class="line">    .find(<span class="string">'g.dataset-0 rect'</span>)</span><br><span class="line">    .should(<span class="string">'have.length'</span>, <span class="number">4</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test now waits for the rectangles to appear - and then it finishes.</p>
<p><img src="/blog/images/testing-a-chart/wait-for-rectangles.gif" alt="Waiting for 4 rectangles"></p>
<p>Since we are always going to load the chart, let us move the <code>cy.visit</code> and rectangle check to <code>beforeEach</code> hook. Even better, we can move the URL to <code>cypress.json</code> settings file.</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"baseUrl"</span>: <span class="string">"http://localhost:1234"</span>,</span><br><span class="line">  <span class="attr">"viewportHeight"</span>: <span class="number">400</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>cypress/integration/first-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types="Cypress" /&gt;</span></span><br><span class="line">beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">'/'</span>)</span><br><span class="line">  <span class="comment">// let the chart load by observing the rendered bars</span></span><br><span class="line">  cy.get(<span class="string">'.frappe-chart g.dataset-0 rect'</span>).should(<span class="string">'have.length'</span>, <span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">'shows bar chart'</span>, () =&gt; &#123;</span><br><span class="line">  cy.get(<span class="string">'.frappe-chart'</span>)</span><br><span class="line">    .should(<span class="string">'be.visible'</span>)</span><br><span class="line">    .and(<span class="function"><span class="params">chart</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// we can assert anything about the chart really</span></span><br><span class="line">      expect(chart.height()).to.be.greaterThan(<span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The <code>beforeEach</code> commands are shown in its own top section of the Command Log.</p>
<p><img src="/blog/images/testing-a-chart/before-each.png" alt="Loading chart before each test"></p>
<h2><span id="testing-tooltip">Testing tooltip</span></h2><p>When I hover over a bar in my chart, a tooltip pops up. Can I test that it does? Cypress <a href="https://github.com/cypress-io/cypress/issues/10" target="_blank" rel="noopener">does not support <code>:hover</code> yet</a>, but looking at the event listeners for the SVG <code>rect</code> element I notice that the tooltip is connected to <code>mousemove</code> and <code>mouseleave</code> events.</p>
<p><img src="/blog/images/testing-a-chart/events.png" alt="Event listeners for `rect` element"></p>
<p>Maybe I can get the tooltip to show up by using <a href="https://on.cypress.io/trigger" target="_blank" rel="noopener"><code>cy.trigger(&#39;mousemove&#39;)</code></a> command?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">'.frappe-chart g.dataset-0 rect'</span>)</span><br><span class="line">  .eq(<span class="number">1</span>) <span class="comment">// pick the "spring" bar</span></span><br><span class="line">  .trigger(<span class="string">'mousemove'</span>)</span><br></pre></td></tr></table></figure>
<p>Yes! The tooltip shows up. Let us confirm it - and because the tooltip is hidden with <code>style=&quot;opacity: 0&quot;</code> attribute, we can assert that it is initially hidden, then shown, then hidden again by writing small utility functions <code>tooltipHidden</code> and <code>tooltipVisible</code>.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/tooltip-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tooltipHidden = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  <span class="comment">// initially the tooltip is not visible</span></span><br><span class="line">  <span class="comment">// because element is set to be hidden using attribute style="opacity:0"</span></span><br><span class="line">  <span class="comment">// we should check its visibility using "have.css" assertion</span></span><br><span class="line">  cy.get(<span class="string">'.graph-svg-tip'</span>).should(<span class="string">'have.css'</span>, <span class="string">'opacity'</span>, <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tooltipVisible = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  cy.get(<span class="string">'.graph-svg-tip'</span>).should(<span class="string">'have.css'</span>, <span class="string">'opacity'</span>, <span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">it(<span class="string">'shows and hides tooltip'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> rectangles = <span class="string">'.frappe-chart g.dataset-0 rect'</span></span><br><span class="line"></span><br><span class="line">  tooltipHidden()</span><br><span class="line">  cy.get(rectangles)</span><br><span class="line">    .eq(<span class="number">1</span>) <span class="comment">// pick the "spring" bar</span></span><br><span class="line">    .trigger(<span class="string">'mousemove'</span>)</span><br><span class="line">    .wait(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tooltipVisible() returns the Cypress element chain</span></span><br><span class="line">  <span class="comment">// so we can add an assertion to check the text</span></span><br><span class="line">  <span class="comment">// shown in the tooltip</span></span><br><span class="line">  tooltipVisible().should(<span class="string">'contain'</span>, <span class="string">'spring'</span>)</span><br><span class="line"></span><br><span class="line">  cy.get(rectangles)</span><br><span class="line">    .eq(<span class="number">1</span>)</span><br><span class="line">    .trigger(<span class="string">'mouseleave'</span>)</span><br><span class="line"></span><br><span class="line">  tooltipHidden()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I have added <code>cy.wait(1000)</code> to pause the test and make the tooltip visible.</p>
<p><img src="/blog/images/testing-a-chart/tooltip.gif" alt="Tooltip test: first the tooltip appears and after 1 second disappears"></p>
<h2><span id="tooltip-for-each-bar">Tooltip for each bar</span></h2><p>A different tooltip appears when the mouse moves over each bar. Let us test it. For now, I will hardcode the season labels in the test.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/seasons-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'shows tooltip for each season'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> rectangles = <span class="string">'.frappe-chart g.dataset-0 rect'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> labels = [<span class="string">'winter'</span>, <span class="string">'spring'</span>, <span class="string">'summer'</span>, <span class="string">'fall'</span>]</span><br><span class="line"></span><br><span class="line">  ;[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">    cy.get(rectangles)</span><br><span class="line">      .eq(k)</span><br><span class="line">      .trigger(<span class="string">'mousemove'</span>)</span><br><span class="line">      .wait(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    cy.get(<span class="string">'.graph-svg-tip'</span>, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;).should(<span class="string">'contain'</span>, labels[k])</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test runs through the four vertical bars and confirms the tooltip has the right label</p>
<p><img src="/blog/images/testing-a-chart/seasons.gif" alt="Seasons labels"></p>
<h2><span id="reading-labels-at-run-time">Reading labels at run-time</span></h2><p>Instead of hardcoding the labels in the test, we can read the labels from the application at run-time. First, we need to expose the chart reference or its data object reference during Cypress tests. Here is my preferred way of doing this:</p>
<figure class="highlight js"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.Cypress) &#123;</span><br><span class="line">  <span class="built_in">window</span>.chart = chart</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>From now on, if you open DevTools during Cypress tests, and point the context at the application&#39;s iframe, you will be able to walk to the labels via <code>window.chart</code> object.</p>
<p><img src="/blog/images/testing-a-chart/chart-data.png" alt="Access labels via `window.chart`"></p>
<p>We can read these labels from our tests too using <a href="https://on.cypress.io/window" target="_blank" rel="noopener"><code>cy.window()</code></a> and <a href="https://on.cypress.io/its" target="_blank" rel="noopener"><code>cy.its()</code></a></p>
<figure class="highlight js"><figcaption><span>cypress/integration/seasons-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'shows tooltip for each defined label'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> rectangles = <span class="string">'.frappe-chart g.dataset-0 rect'</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// labels are accessed at run-time from the chart object</span></span><br><span class="line">  cy.window()</span><br><span class="line">    .its(<span class="string">'chart.data.labels'</span>)</span><br><span class="line">    <span class="comment">// make sure we have a valid list with labels</span></span><br><span class="line">    .should(<span class="string">'have.length.gt'</span>, <span class="number">0</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">labels</span> =&gt;</span> &#123;</span><br><span class="line">      labels.forEach(<span class="function">(<span class="params">label, k</span>) =&gt;</span> &#123;</span><br><span class="line">        cy.get(rectangles)</span><br><span class="line">          .eq(k)</span><br><span class="line">          .trigger(<span class="string">'mousemove'</span>)</span><br><span class="line">          .wait(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">        cy.get(<span class="string">'.graph-svg-tip'</span>, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;).should(<span class="string">'contain'</span>, label)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Super, the test is passing, just like before, but now the labels are not copied.</p>
<h2><span id="reading-labels-at-compile-time">Reading labels at compile-time</span></h2><p>Instead of exposing the application and reading labels <em>during</em> the test, we can factor the labels into its own JavaScript module and share them between the application and the test code. We are already using <a href="https://parceljs.org/" target="_blank" rel="noopener">parcel-bundler</a> to serve our code, so we can just extract the labels into its own file.</p>
<figure class="highlight js"><figcaption><span>labels.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> labels = [<span class="string">'winter'</span>, <span class="string">'spring'</span>, <span class="string">'summer'</span>, <span class="string">'fall'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; labels &#125; <span class="keyword">from</span> <span class="string">'./labels'</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  labels,</span><br><span class="line">  datasets: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'Sunny days'</span>,</span><br><span class="line">      type: <span class="string">'bar'</span>,</span><br><span class="line">      values: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">25</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The application is bundled using <code>parcel-bundler</code> and served - just like before.</p>
<p>Cypress includes its own bundler, so we import <code>labels</code> from the spec file.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/labels-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types="Cypress" /&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; labels &#125; <span class="keyword">from</span> <span class="string">'../../labels'</span></span><br><span class="line">beforeEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">'/'</span>)</span><br><span class="line">  <span class="comment">// let the chart load by observing the rendered bars</span></span><br><span class="line">  cy.get(<span class="string">'.frappe-chart g.dataset-0 rect'</span>).should(<span class="string">'have.length'</span>, <span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">'shows tooltip for each imported label'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> rectangles = <span class="string">'.frappe-chart g.dataset-0 rect'</span></span><br><span class="line"></span><br><span class="line">  labels.forEach(<span class="function">(<span class="params">label, k</span>) =&gt;</span> &#123;</span><br><span class="line">    cy.get(rectangles)</span><br><span class="line">      .eq(k)</span><br><span class="line">      .trigger(<span class="string">'mousemove'</span>)</span><br><span class="line">      .wait(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    cy.get(<span class="string">'.graph-svg-tip'</span>, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;).should(<span class="string">'contain'</span>, label)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Great, all working, and there is no code duplication.</p>
<h2><span id="visual-diffing-with-applitools-plugin">Visual diffing with Applitools plugin</span></h2><p>But what if the charts library publishes a new version, changing the appearance of the bar chart? Or what if someone comes and changes the beautiful blue color in <code>app.js</code> from <code>#7cd6fd</code> to the ugly <code>#816c30</code>? The functional tests like we have written above cannot check if the chart looks the same. Yes, we could check each positional property and every style property of every element on the page ... and that will super painful to write as a test.</p>
<p>Instead let&#39;s set up image diffing testing, in this case I will use <a href="https://applitools.com/tutorials/cypress.html" target="_blank" rel="noopener">Applitools Cypress plugin</a>.</p>
<p>First, I will install the Applitools Cypress plugin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @applitools/eyes-cypress --save-dev</span><br></pre></td></tr></table></figure>
<p>Then I need to run</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx eyes-setup</span><br></pre></td></tr></table></figure>
<p>Which should do 2 things: load Applitools from Cypress plugins file and load Applitools commands from the support file</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">on, config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// `on` is used to hook into various events Cypress emits</span></span><br><span class="line">  <span class="comment">// `config` is the resolved Cypress config</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// added by Applitools</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'@applitools/eyes-cypress'</span>)(<span class="built_in">module</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>cypress/support/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// added by Applitools</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'@applitools/eyes-cypress/commands'</span></span><br></pre></td></tr></table></figure>
<p>I then made an Applitools account using my GitHub account and grabbed my Applitools API key. The image below comes from the <a href="https://applitools.com/tutorials/cypress.html#quick-start" target="_blank" rel="noopener">Applitools Cypress Quickstart tutorial</a>.</p>
<p><img src="/blog/images/testing-a-chart/applitools-API-key.gif" alt="personal Applitools API key"></p>
<p>Then from the terminal I have exported the key once</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> APPLITOOLS_API_KEY=&lt;my api key&gt;</span><br></pre></td></tr></table></figure>
<p>And now I am good to go. I have updated my tooltip test to use <code>cy.eye...</code> commands created by the Applitools plugin.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'shows tooltip for each season'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// start new batch of images</span></span><br><span class="line">  cy.eyesOpen(&#123;</span><br><span class="line">    appName: <span class="string">'chart-testing-example'</span>,</span><br><span class="line">    batchName: <span class="string">'tooltips'</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rectangles = <span class="string">'.frappe-chart g.dataset-0 rect'</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> labels = [<span class="string">'winter'</span>, <span class="string">'spring'</span>, <span class="string">'summer'</span>, <span class="string">'fall'</span>]</span><br><span class="line"></span><br><span class="line">  labels.forEach(<span class="function">(<span class="params">label, k</span>) =&gt;</span> &#123;</span><br><span class="line">    cy.get(rectangles)</span><br><span class="line">      .eq(k)</span><br><span class="line">      .trigger(<span class="string">'mousemove'</span>)</span><br><span class="line">      .wait(<span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">    cy.get(<span class="string">'.graph-svg-tip'</span>, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;).should(<span class="string">'contain'</span>, label)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we limit the visual diff to the chart</span></span><br><span class="line">    cy.eyesCheckWindow(&#123;</span><br><span class="line">      sizeMode: <span class="string">'selector'</span>,</span><br><span class="line">      selector: <span class="string">'.frappe-chart'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cy.eyesClose() <span class="comment">// tell Applitools we are done</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I run Cypress locally (with <code>APPLITOOLS_API_KEY</code> environment variable). A few seconds after the test completes, the Applitools web application dashboard shows the 4 images.</p>
<p><img src="/blog/images/testing-a-chart/applitools-batch.png" alt="Applitools shows the new batch of images"></p>
<p>Because this is a new batch, all images were automatically accepted and saved as baselines. Let us change the color of the bars to my least favorite color <code>#816c30</code> and just push the code to CI. I am using CircleCI and I have already set the <code>APPLITOOLS_API_KEY</code> as an environment variable there.</p>
<p>The CI run has failed, see <a href="https://circleci.com/gh/bahmutov/chart-testing-example/4" target="_blank" rel="noopener">https://circleci.com/gh/bahmutov/chart-testing-example/4</a> - and it has failed after the Applitools cloud that actually does image rendering and comparison has reported the changes asynchronously back to the test runner. That&#39;s why the failures are not reported immediately during the test, but inside the <code>after</code> test callback.</p>
<p><img src="/blog/images/testing-a-chart/ci-visual-diff-error.png" alt="Visual diff has failed"></p>
<p>Let us go the Applitool dashboard to see why the test has failed visual comparison.</p>
<p><img src="/blog/images/testing-a-chart/visual-diff.png" alt="Visual diff showing changes"></p>
<p>We can go into each image to see the difference with the saved baseline image. For example we can toggle (T) between the new image and the baseline.</p>
<p><img src="/blog/images/testing-a-chart/diff.gif" alt="Toggle mode"></p>
<p>We can even highlight the changed areas (although it is pretty clear in this case where the changes are)</p>
<p><img src="/blog/images/testing-a-chart/highlight-diff.gif" alt="Highlight differences mode"></p>
<p>There is one more interesting feature the Applitools analysis offers. I can click on the &quot;&lt;&gt;&quot; button which opens a root cause analysis view. In this view, if I show the &quot;diff&quot; of the images, it also shows WHY the images have changed. In our case it correctly shows the root of the problem: the change &quot;style: fill&quot; property!</p>
<p><img src="/blog/images/testing-a-chart/visual-diff-root-cause-analysis.png" alt="Root cause analysis"></p>
<p>I don&#39;t like the new color, so I will revert the commit and push again.</p>
<h2><span id="conclusions">Conclusions</span></h2><ul>
<li>testing an SVG chart is pretty close to testing a regular DOM using Cypress</li>
<li>for visual regressions, consider using an image diffing tool. There are several choices, both commercial and open source<ul>
<li><a href="https://applitools.com" target="_blank" rel="noopener">Applitools.com</a></li>
<li><a href="https://on.cypress.io/plugins#visual-testing" target="_blank" rel="noopener">several other plugins</a></li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> you can find the source code for this blog post at <a href="https://github.com/bahmutov/chart-testing-example" target="_blank" rel="noopener">github.com/bahmutov/chart-testing-example</a>.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/testing-a-chart/" data-id="ck1ic55o8019ooioordgrqre1" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/testing-a-chart/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../testing-visually/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Testing how an application renders a drawing with Cypress and Percy.io
        
      </div>
    </a>
  
  
    <a href="../parallel-or-not/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Parallel or not</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">115</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">319</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/">a11y</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">100</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">47</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/">github</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/">graphql</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">161</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">79</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">99</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/zeit/">zeit</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.67px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10px;">a11y</a> <a href="../tags/advice/" style="font-size: 19.58px;">advice</a> <a href="../tags/angularjs/" style="font-size: 17.92px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.33px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.92px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.42px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.25px;">browser</a> <a href="../tags/ci/" style="font-size: 13.33px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.5px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 17.5px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.83px;">d3</a> <a href="../tags/db/" style="font-size: 14.17px;">db</a> <a href="../tags/docker/" style="font-size: 14.17px;">docker</a> <a href="../tags/es6/" style="font-size: 15px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.33px;">functional</a> <a href="../tags/generators/" style="font-size: 11.67px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 11.25px;">github</a> <a href="../tags/graphql/" style="font-size: 10.83px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.5px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.83px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 12.5px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.67px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.83px;">interview</a> <a href="../tags/jade/" style="font-size: 11.25px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.83px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 16.67px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 18.75px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.83px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.25px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.08px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.42px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 10px;">react</a> <a href="../tags/reactive/" style="font-size: 14.58px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.83px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.5px;">security</a> <a href="../tags/sentry/" style="font-size: 13.75px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.08px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.17px;">testing</a> <a href="../tags/tutorial/" style="font-size: 14.17px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.67px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.42px;">ui</a> <a href="../tags/vuejs/" style="font-size: 11.25px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.08px;">web workers</a> <a href="../tags/zeit/" style="font-size: 12.08px;">zeit</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../testing-angular-application-via-app-actions/">Testing Angular application via App Actions</a>
          </li>
        
          <li>
            <a href="../visual-diffing-for-CLI-apps/">Visual diffing flow for your pretty CLI applications</a>
          </li>
        
          <li>
            <a href="../configure-prettier-in-vscode/">How to configure Prettier and VSCode</a>
          </li>
        
          <li>
            <a href="../cypress-using-child-window/">Cypress using child window</a>
          </li>
        
          <li>
            <a href="../patching-cypress-cli-npm-module/">Patching Cypress CLI NPM module</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/testing-a-chart/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
