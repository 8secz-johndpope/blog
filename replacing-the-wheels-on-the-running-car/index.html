<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Replacing the wheels on the running car | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Despite what people might think, NPM has a huge advantage over other systems - it uses semantic versions when installing dependencies. If your module depends on another module &amp;quot;foo&amp;quot;, you hav">
<meta name="keywords" content="modular development">
<meta property="og:type" content="article">
<meta property="og:title" content="Replacing the wheels on the running car">
<meta property="og:url" content="https://glebbahmutov.com/blog/replacing-the-wheels-on-the-running-car/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Despite what people might think, NPM has a huge advantage over other systems - it uses semantic versions when installing dependencies. If your module depends on another module &amp;quot;foo&amp;quot;, you hav">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Replacing the wheels on the running car">
<meta name="twitter:description" content="Despite what people might think, NPM has a huge advantage over other systems - it uses semantic versions when installing dependencies. If your module depends on another module &amp;quot;foo&amp;quot;, you hav">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-replacing-the-wheels-on-the-running-car" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2016-03-24T04:00:00.000Z" itemprop="datePublished">Mar 24 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Replacing the wheels on the running car
    </h1>

    <h2 class="article-title" itemprop="name">
      How to use semantic versioning with external services.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Despite what people might think, NPM has a huge advantage over other
systems - it uses <a href="http://semver.org/" target="_blank" rel="noopener">semantic versions</a> when installing
dependencies. If your module depends on another module &quot;foo&quot;, you have to
specify which particular version or range of versions is acceptable.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"foo"</span>: <span class="string">"0.1.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>I suppose that your project has unit tests, and once they all pass, you assume that &quot;foo@1.0.0&quot;
is the dependency you know <em>works reliably</em>. The &quot;foo&quot; package can have other releases, of course,
and you can look them up, I advise using my 
<a href="https://github.com/bahmutov/available-versions" target="_blank" rel="noopener">available-versions</a> for this</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g available-versions</span><br><span class="line">$ vers foo@1.0.0</span><br><span class="line">foo since 1.0.0</span><br><span class="line">--------------------------</span><br><span class="line">version  age      dist-tag</span><br><span class="line">-------  -------  --------</span><br><span class="line">1.0.1    a month</span><br><span class="line">1.0.2    a month</span><br><span class="line">1.1.0    19 days</span><br><span class="line">1.2.0    10 days  stable</span><br></pre></td></tr></table></figure>
<p>Just by looking at the new versions, we can see that there are 2 patch releases 1.0.1 and 1.0.2
that probably have bug fixes. Then there are two new feature releases that preserve backward
compatability 1.1.0 and 1.2.0 - in fact I look at the versions not as absolute, but as difference
from the current one</p>
<ul>
<li><code>changed.same.same</code> = breaking API change, danger!</li>
<li><code>same.changed.same</code> = new feature, yum!</li>
<li><code>same.same.changed</code> = bug fix, thank you, kind developer!</li>
</ul>
<p>I can easily control which version of &quot;foo&quot; I use - I list its version in the <code>package.json</code> file,
I can use strict version (without any <code>^</code>, <code>~</code> or <code>*</code> ranges), and I can test new versions at my
leisure before switching (I recommend using <a href="https://github.com/bahmutov/next-update" target="_blank" rel="noopener">next-update</a>).</p>
<h2><span id="service-dependencies">Service dependencies</span></h2><p>The &quot;static&quot; installed dependencies above are simple. But we have another type of dependencies
that are much much harder to control - the external 3rd party services we call at runtime.
For example, if your application calls the GitHub API, then you are using a 3rd party service.
My <code>next-update</code> tool calls <a href="https://next-update.herokuapp.com/" target="_blank" rel="noopener">next-update.herokuapp.com</a> to
display the update statistics for a package. If you split your application into a pool of
micro services, each one is likely to call others many many times.</p>
<p>Versioning service dependencies is an open field; there are no standards and people have very
strong opinions <a href="http://www.troyhunt.com/2014/02/your-api-versioning-is-wrong-which-is.html" target="_blank" rel="noopener">what method is the best</a>. Main methods are: including API version
in the request URL, or setting a special header or even including the desired version in the
&quot;Accept&quot; header. All these schemes in my opinion make the problem much harder by being the opposite 
of the NPM&#39;s solution and be giving the service too much work to do. 
Let us take a look at how we can solve the service versioning in the similar fashion to NPM.</p>
<ol>
<li>The dependency package &quot;foo&quot; should NOT implement multiple API versions simultaneously.
Instead, it publishes a new version to the registry. It is up to NPM installer to pick the
correct version depending on what is specified in the <code>package.json</code>. Similarly, it is a 
burden on the service author to support multiple versions <em>simultaneously</em>. Instead a deploy
process should allow running multiple service versions in parallel.</li>
<li>Usually our module gets the service URL injected somehow instead of hardcoding it. Maybe
it is a config file or an environment variable - all we have is an URL to call. How do we know
if this is the right service? We cannot know, instead the service can <em>return its own version</em>
with the response. Then the client can check the received version against the expected 
service version or range.</li>
</ol>
<p>The second point is important - we do not have the control over the deployment in a distributed
heterogeneous environment. The most we can do is to make a request, hope it gets to the right
service, and check the response - is the executor service the right one? How do we know it is a 
right one for us? By testing of course! Just like we did in unit testing, 
once we have tested and confirmed
that <code>foo@1.0.0</code> is acceptable, we set its version in the <code>package.json</code>. Same with the external
services. Once we have tested GitHub API and confirmed that v3 works for us, we should validate
every GitHub response to make sure that we are getting v3 responses. If we all of the sudden
get v2 or v4 response - something is wrong!</p>
<p>A service can embed name and version in the response headers, here is my 
<a href="https://github.com/bahmutov/koa-version-header" target="_blank" rel="noopener">koa-version-header</a> for example. Any request
gets the information necessary to validate if the service is acceptable.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> serviceVersion = <span class="built_in">require</span>(<span class="string">'koa-version-header'</span>)</span><br><span class="line"><span class="keyword">const</span> app = koa()</span><br><span class="line">app.use(serviceVersion())</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> * (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.body = <span class="string">'ok'</span></span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ http localhost:3000</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 2</span><br><span class="line">Content-Type: text/plain; charset=utf-8</span><br><span class="line">Date: Wed, 23 Mar 2016 19:37:26 GMT</span><br><span class="line">X-Service-Name: koa-version-header</span><br><span class="line">X-Service-Version: 0.0.0-semantic-release</span><br><span class="line">ok</span><br></pre></td></tr></table></figure>
<p>From an application you can validate the version using semantic versioning package</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// list run time service dependencies</span></span><br><span class="line"><span class="comment">// https://github.com/npm/node-semver#advanced-range-syntax</span></span><br><span class="line"><span class="keyword">const</span> serviceDependencies = &#123;</span><br><span class="line">  <span class="string">'test-service'</span>: <span class="string">'~2.3.0'</span></span><br><span class="line">&#125;</span><br><span class="line">axios.get(url)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> serviceName = response.headers[<span class="string">'x-service-name'</span>]</span><br><span class="line">    <span class="keyword">const</span> serviceVersion = response.headers[<span class="string">'x-service-version'</span>]</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`got response from <span class="subst">$&#123;serviceName&#125;</span>@<span class="subst">$&#123;serviceVersion&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> expectedVersion = serviceDependencies[serviceName]</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> expectedVersion === <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`is this service version acceptable? We need <span class="subst">$&#123;expectedVersion&#125;</span>`</span>)</span><br><span class="line">      <span class="comment">// https://github.com/npm/node-semver#ranges-1</span></span><br><span class="line">      <span class="keyword">const</span> satisfies = semver.satisfies(serviceVersion, expectedVersion)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`satisfies? <span class="subst">$&#123;satisfies&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>The above example is from this 
<a href="https://github.com/bahmutov/koa-version-header/blob/master/demo/ping.js" target="_blank" rel="noopener">demo</a></p>
<p>To simplify checking I <a href="https://github.com/bahmutov/axios-version" target="_blank" rel="noopener">implemented the version validation</a> 
for requests that use the <a href="https://github.com/bahmutov/axios-version" target="_blank" rel="noopener">axios</a> library. 
Other libraries allow other interceptors, and if the excellent <a href="https://github.com/node-nock/nock" target="_blank" rel="noopener">nock</a>
implements <a href="https://github.com/node-nock/nock/issues/346" target="_blank" rel="noopener">andCallThrough</a> feature, then you
could validate the service requests from any library.</p>
<p>If the service does NOT satisfy our requirement - well, a runtime exception should probably
be sent to a <a href="../know-unknown-unknowns-with-sentry/">crash monitoring service</a>. Point is that
something went wrong - maybe the deploy failed and an old external service is still responding
to the calls, or maybe the external service has been upgraded but not the client application.</p>
<h2><span id="conclusion">Conclusion</span></h2><p>During <code>npm install</code> you have the power to tell NPM which version of a dependency is acceptable.
If a specific version is unavailable, the install fails. Similarly, during execution, if a
semantically acceptable version of an external service is unavailable, you should be notified and
fail. By embedding the version information in the <em>response</em> as opposed to <em>request</em> you
decouple the client from the service itself; the service should not have the burden of implementing
multiple versions.</p>
<p>If testing and upgrading NPM module versions is like switching parts when assembling a car,
validating versions in a deployed system is like replacing a wheel on a moving car - hard, but
might be the only way to keep all the parts the same except for a specific one.</p>
<h2><span id="resources">Resources</span></h2><ul>
<li><a href="https://github.com/mzabriskie/axios" target="_blank" rel="noopener">axios library</a> for promise-returning Ajax calls</li>
<li><a href="https://github.com/bahmutov/axios-version" target="_blank" rel="noopener">axios-version</a> validates version in interceptor</li>
<li><a href="https://github.com/bahmutov/koa-version-header" target="_blank" rel="noopener">koa-version-header</a> middleware for Koa server
that adds name and version to the response headers</li>
<li><a href="http://semver.org/" target="_blank" rel="noopener">semver</a></li>
<li><a href="http://senecajs.org/" target="_blank" rel="noopener">Seneca</a> microservices does NOT talk about versions</li>
<li><a href="http://www.troyhunt.com/2014/02/your-api-versioning-is-wrong-which-is.html" target="_blank" rel="noopener">Your API versioning is wrong</a></li>
<li><a href="http://www.narwhl.com/2015/03/the-ultimate-solution-to-versioning-rest-apis-content-negotiation/" target="_blank" rel="noopener">THE ULTIMATE SOLUTION TO VERSIONING REST APIS: CONTENT NEGOTIATION</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  var s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/replacing-the-wheels-on-the-running-car/" data-id="cjebhac3j00ok07oojwf63v31" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/replacing-the-wheels-on-the-running-car/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/modular-development/">modular development</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../javascript-nuggets/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          JavaScript nuggets
        
      </div>
    </a>
  
  
    <a href="../simple-ajax-testing/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Simple Ajax testing</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">101</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">276</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">97</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">67</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.9px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.52px;">advice</a> <a href="../tags/angularjs/" style="font-size: 18.1px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.81px;">assertions</a> <a href="../tags/ast/" style="font-size: 13.33px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 16.19px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.67px;">browser</a> <a href="../tags/ci/" style="font-size: 12.86px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.86px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 14.29px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.95px;">d3</a> <a href="../tags/db/" style="font-size: 14.29px;">db</a> <a href="../tags/docker/" style="font-size: 13.81px;">docker</a> <a href="../tags/es6/" style="font-size: 15.71px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.57px;">functional</a> <a href="../tags/generators/" style="font-size: 11.9px;">generators</a> <a href="../tags/git/" style="font-size: 14.76px;">git</a> <a href="../tags/grunt/" style="font-size: 12.86px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.95px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 11.9px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.43px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.95px;">interview</a> <a href="../tags/jade/" style="font-size: 11.43px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.95px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 17.14px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 19.05px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.67px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.43px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.62px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.48px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 15.24px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.48px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.86px;">security</a> <a href="../tags/sentry/" style="font-size: 14.29px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.38px;">service workers</a> <a href="../tags/testing/" style="font-size: 19.05px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.33px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.48px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.48px;">ui</a> <a href="../tags/vuejs/" style="font-size: 10.95px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.38px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../subfolders-as-dependencies/">Subfolders as Dependencies</a>
          </li>
        
          <li>
            <a href="../parcel/">Parcel Bundler</a>
          </li>
        
          <li>
            <a href="../use-lenses-in-hyperapp/">Use Lenses in Hyperapp</a>
          </li>
        
          <li>
            <a href="../testing-es6-module-in-cypress-electron/">Testing ES6 Module in Cypress Electron Browser</a>
          </li>
        
          <li>
            <a href="../drive-by-testing-array-explorer/">Drive-by Testing Array Explorer</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/replacing-the-wheels-on-the-running-car/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
