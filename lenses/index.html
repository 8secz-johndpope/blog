<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>I can see clearly now | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Consider object property access. We mostly think of this as a built-in JavaScript syntax. Reading a value at a given property &amp;quot;foo&amp;quot; happens as soon as we write 1O.foo // value of property &quot;f">
<meta name="keywords" content="functional">
<meta property="og:type" content="article">
<meta property="og:title" content="I can see clearly now">
<meta property="og:url" content="https://glebbahmutov.com/blog/lenses/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Consider object property access. We mostly think of this as a built-in JavaScript syntax. Reading a value at a given property &amp;quot;foo&amp;quot; happens as soon as we write 1O.foo // value of property &quot;f">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/lenses/nyc.jpg">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/lenses/nyc-deliveries.jpg">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/lenses/rambot.png">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="I can see clearly now">
<meta name="twitter:description" content="Consider object property access. We mostly think of this as a built-in JavaScript syntax. Reading a value at a given property &amp;quot;foo&amp;quot; happens as soon as we write 1O.foo // value of property &quot;f">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/lenses/nyc.jpg">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-lenses" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2017-07-22T04:00:00.000Z" itemprop="datePublished">Jul 22 2017</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      I can see clearly now
    </h1>

    <h2 class="article-title" itemprop="name">
      Using functional lenses to modify objects by example.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Consider object property access. We mostly think of this as a built-in
JavaScript syntax. Reading a value at a given property &quot;foo&quot; happens as soon
as we write</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O.foo <span class="comment">// value of property "foo" in object "O"</span></span><br></pre></td></tr></table></figure>
<p>Similarly, as soon as we write the assignment operator we set the value
of property &quot;foo&quot;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O.foo = <span class="string">"bar"</span></span><br><span class="line"><span class="comment">// object "O" has property "foo" with value "bar"</span></span><br></pre></td></tr></table></figure>
<p>What if we wanted to split reading property &quot;foo&quot; into two steps. Step 1 would
just configure it, and step 2 would actually read it? We could easily do this
using a closure</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> read = <span class="function"><span class="params">property</span> =&gt;</span> object =&gt; object[property]</span><br></pre></td></tr></table></figure>
<p>The function returning a function - that&#39;s a common approach. The first call
only specifies the property name we plan to access and returns a function
that is waiting for an actual object. Interesting that we could call <code>read</code>
once and then use the returned function <em>multiple times, even on different
objects</em>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> read = <span class="function"><span class="params">property</span> =&gt;</span> object =&gt; object[property]</span><br><span class="line"><span class="keyword">const</span> fooReader = read(<span class="string">'foo'</span>)</span><br><span class="line">fooReader(&#123;<span class="attr">foo</span>: <span class="number">42</span>&#125;)    <span class="comment">// 42</span></span><br><span class="line">fooReader(&#123;<span class="attr">bar</span>: <span class="string">'baz'</span>&#125;) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>We could make a &quot;writer&quot; similarly, and we could even curry the function
to accept property, value and object in three separate calls</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> write = <span class="function"><span class="params">property</span> =&gt;</span> value =&gt; <span class="function"><span class="params">object</span> =&gt;</span> object[property] = value</span><br><span class="line"><span class="keyword">const</span> fooSet = write(<span class="string">'foo'</span>)</span><br><span class="line"><span class="keyword">const</span> fooSet5 = fooSet(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> o = &#123;&#125;</span><br><span class="line">fooSet5(o)</span><br><span class="line"><span class="comment">// o is &#123;foo: 5&#125;</span></span><br></pre></td></tr></table></figure>
<p>We could make <code>write</code> immutable to make sure we are not modifying the object
when setting a property, and we could also support deep paths.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fooBarBazSet = write(<span class="string">'foo.bar.baz'</span>)</span><br><span class="line"><span class="keyword">const</span> o = ...</span><br><span class="line"><span class="keyword">const</span> updated = fooBarBazSet(<span class="number">5</span>, o)</span><br></pre></td></tr></table></figure>
<p>Not only we do not know which object we are going to query or update;
we do not even know if we are going to <em>read or write</em> value at a given
path like <code>foo.bar.baz</code>. Thus the first call should just &quot;save&quot; the path,
and then a separate function call should know how to read or write.</p>
<h2><span id="lenses">Lenses</span></h2><p>Wrapping a path like <code>foo.bar.baz</code> so that in the future we can read from
that location in some object, or set its value is called creating a &quot;lens&quot;.
In Ramda world, it works like this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fooBarBazLens = R.lensPath([<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// reading value is called `R.view`</span></span><br><span class="line"><span class="keyword">const</span> readFooBarBaz = R.view(fooBarBazLens)</span><br><span class="line">readFooBarBaz(&#123;<span class="attr">foo</span>: &#123;<span class="attr">bar</span>: &#123;<span class="attr">baz</span>: <span class="number">42</span>&#125;&#125;&#125;)</span><br><span class="line"><span class="comment">//=&gt; 42</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// writing value is called `R.set`</span></span><br><span class="line"><span class="keyword">const</span> setFooBarBaz = R.set(readFooBarBaz)</span><br><span class="line"><span class="keyword">const</span> o = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> output = setFooBarBaz(<span class="number">1</span>, o)</span><br><span class="line"><span class="comment">// o is still &#123;&#125;</span></span><br><span class="line"><span class="comment">// output is &#123;foo: &#123;bar: &#123;baz: 1&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>Hmm, I wish writing a value using a path inside lens was called &quot;R.project&quot; 😃.
But that name is already taken.</p>
<p>If we deal with single level (a plain property), we have function
<a href="http://ramdajs.com/docs/#lensProp" target="_blank" rel="noopener">R.lensProp</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fooLens = R.lensProp(<span class="string">'foo'</span>)</span><br><span class="line">R.view(fooLens, &#123;<span class="attr">foo</span>: <span class="number">42</span>&#125;) <span class="comment">// 42</span></span><br></pre></td></tr></table></figure>
<p>which is equivalent of <code>R.lensPath([&#39;foo&#39;])</code></p>
<h2><span id="lenses-as-street-directions">Lenses as street directions</span></h2><p>Here is an analogy that helps visualize the lens concept. Imagine giving
street directions like &quot;north 2 blocks, east 1 block then north 4 blocks&quot;.
Directions like this could be used to deliver a box or pick up a box
(write and read property value respectively). And directions like this
would work (usually) in any intersection city; Manhattan in New York City
is a good place.</p>
<p><img src="/blog/images/lenses/nyc.jpg" alt="Directions in NYC"></p>
<p>We can apply same directions &quot;N 2, E 1, N 4&quot;, and if we start at different
places, we will end up in 3 different places.</p>
<ul>
<li>starting at 17th st and 10th ave we will arrive at 23 st and 9th avenue.</li>
<li>from 14th and 8th we get to 20th and 7th</li>
<li>from 11th and 6th we get to 17th and 5th</li>
</ul>
<p>Using same directions we can pick up a box or drop it off.</p>
<p><img src="/blog/images/lenses/nyc-deliveries.jpg" alt="Delivering and picking up values using directions"></p>
<p>That&#39;s how I think of lenses.</p>
<h2><span id="lenses-for-the-win">Lenses for the win</span></h2><p>Here is a cool use for lenses. I hate programming. Well, not really hate the
programming itself as much as I hate the boring code writing. For example, we
often take some objects and transform them into other objects; usually
picking only some properties, trimming strings etc. Libraries like Ramda
and Lodash make it simpler with its variety of functions to modify objects.</p>
<p>Check out things like <a href="http://ramdajs.com/docs/#pick" target="_blank" rel="noopener">R.pick</a> and
<a href="http://ramdajs.com/docs/#evolve" target="_blank" rel="noopener">R.evolve</a> - they make object transform
quick, yet still this is rote work 👎.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tomato = &#123;</span><br><span class="line">  firstName: <span class="string">'  Tomato '</span>,</span><br><span class="line">  data: &#123;<span class="attr">elapsed</span>: <span class="number">100</span>, <span class="attr">remaining</span>: <span class="number">1400</span>&#125;,</span><br><span class="line">  id:<span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> transformations = &#123;</span><br><span class="line">  firstName: R.trim,</span><br><span class="line">  lastName: R.trim, <span class="comment">// Will not get invoked.</span></span><br><span class="line">  data: &#123;<span class="attr">elapsed</span>: R.add(<span class="number">1</span>), <span class="attr">remaining</span>: R.add(<span class="number">-1</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line">R.pick([<span class="string">'firstName'</span>], R.evolve(transformations, tomato))</span><br><span class="line"><span class="comment">//=&gt; &#123;firstName: 'Tomato'&#125;</span></span><br></pre></td></tr></table></figure>
<p>We often have the initial object, and if we write the above code a bot
can quickly evaluate it and give us the output. This is often used to
play with code snippets on <a href="https://gitter.im/ramda/ramda" target="_blank" rel="noopener">Ramda Gitter channel</a></p>
<p><img src="/blog/images/lenses/rambot.png" alt="Rambot in action"></p>
<p>This has a huge huge shortcoming, actually 2 of them.</p>
<ol>
<li>We usually have the input object and <em>the desired output object</em>,
but not the code. We have to write the code.</li>
<li>Writing code is <strong>freaking complicated</strong> and requires skills and experience.
Who has time for that?</li>
</ol>
<p>What if we could just give input and output objects and let a bot / CLI /
program compute the transformation code?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tomato = &#123;</span><br><span class="line">  firstName: <span class="string">'  Tomato '</span>,</span><br><span class="line">  data: &#123;<span class="attr">elapsed</span>: <span class="number">100</span>, <span class="attr">remaining</span>: <span class="number">1400</span>&#125;,</span><br><span class="line">  id:<span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> desired = &#123;<span class="attr">firstName</span>: <span class="string">'Tomato'</span>&#125;</span><br><span class="line"><span class="keyword">var</span> t = verySmartBot(tomato, desired)</span><br></pre></td></tr></table></figure>
<p>The computed function <code>t</code> is a transformation function that not only
computes <code>t(tomato)</code> to be <code>desired</code>, but applies <em>same transformation</em>
to any object with the same <em>shape</em> as input. For example</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> banana = &#123;</span><br><span class="line">  firstName: <span class="string">' Banana'</span>,</span><br><span class="line">  data: <span class="string">'some data'</span>,</span><br><span class="line">  id: <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line">t(banana)</span><br><span class="line"><span class="comment">// &#123;firstName: 'Banana'&#125;</span></span><br></pre></td></tr></table></figure>
<p>Cool cool cool, so now anyone can &quot;program&quot; by showing the program &quot;before&quot;
and &quot;after&quot; objects, how do we write this &quot;verySmartBot&quot; program and what
do lenses have to do with it?</p>
<p>Well, take a look at <em>every property</em> in the output object, like <code>firstName</code>.
We can brute force search for same value in the input object, and will file
matching property <code>firstName</code> (value is important, not the property name
itself). So we find that our transformation needs to</p>
<ul>
<li>read property <code>firstName</code> from the source object (any future source object)</li>
<li>transform it using <code>R.trim</code></li>
<li>write value into property <code>firstName</code> of the destination object</li>
</ul>
<p>Hmm, does this look familiar? Reading source property while deferring the
actual object is viewing via a lens <code>R.view(R.lensProp(&#39;firstName&#39;))</code>.
Writing a value into an object is setting via a lens
<code>R.set(R.lensProp(&#39;firstName&#39;))</code>. And in the middle there is <code>R.trim(value)</code>!</p>
<p>Take a look a the implementation in <a href="https://github.com/bahmutov/change-by-example" target="_blank" rel="noopener">change-by-example</a>.
The search for each destination property grabs all paths in the object,
including deep properties</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allPaths = <span class="function">(<span class="params">obj</span>) =&gt;</span> ...</span><br><span class="line"><span class="keyword">const</span> paths = allPaths(destination)</span><br><span class="line"><span class="comment">// paths = [['firstName'], ['data'], ['id']]</span></span><br><span class="line">paths.forEach(<span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> destinationValue = R.view(R.lensPath(path), destination)</span><br><span class="line">  <span class="comment">// find source property</span></span><br><span class="line">  <span class="keyword">const</span> readTransform = findTransformTo(destinationValue)</span><br><span class="line">  <span class="keyword">if</span> (readTransform) &#123;</span><br><span class="line">    <span class="comment">// found!</span></span><br><span class="line">    <span class="keyword">const</span> write = R.set(R.lensPath(path))</span><br><span class="line">    <span class="keyword">const</span> readAndWrite = <span class="function">(<span class="params"><span class="keyword">from</span>, to</span>) =&gt;</span> write(readTransform(<span class="keyword">from</span>), to)</span><br><span class="line">    destinationPropertyTransforms.push(readAndWrite)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>You can see how simple the code is yourself <a href="https://github.com/bahmutov/change-by-example/blob/c4ac5a3d018e7cdd1bc56fb86021eedae88854a0/src/index.js#L21" target="_blank" rel="noopener">here</a></p>
<p>Similarly, to find the source property (even if deep inside the source
object), we use <code>allPaths</code> and lenses for each path.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find lens inside the source object</span></span><br><span class="line"><span class="comment">// and transform to produce given value</span></span><br><span class="line"><span class="keyword">let</span> sourceLens</span><br><span class="line"><span class="keyword">let</span> transform</span><br><span class="line"><span class="keyword">const</span> paths = allPaths(source)</span><br><span class="line">paths.some(<span class="function"><span class="params">path</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> sourceValue = R.view(R.lensPath(path), source)</span><br><span class="line">  <span class="keyword">const</span> foundTransform = allTransforms.some(<span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> out = t(sourceValue)</span><br><span class="line">      <span class="keyword">if</span> (R.equals(value, out)) &#123;</span><br><span class="line">        sourceLens = path</span><br><span class="line">        transform = t</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> foundTransform</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// return sourceLens and transform</span></span><br></pre></td></tr></table></figure>
<p>That&#39;s it. This abstracts access to every property in the source object
and in the destination object and allows quickly finding matching ones.
Then we can just give it two objects and enjoy programming-free computing.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = &#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    first: <span class="string">'joe'</span>,</span><br><span class="line">    last: <span class="string">'smith'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  occupation: <span class="string">'plumber'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> destination = &#123;</span><br><span class="line">  firstName: <span class="string">'Joe'</span>,</span><br><span class="line">  job: <span class="string">'plumber'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> verySmartBot = <span class="built_in">require</span>(<span class="string">'change-by-example'</span>)</span><br><span class="line"><span class="keyword">const</span> t = verySmartBot(source, destination)</span><br><span class="line"><span class="comment">// now give the "t" a different object</span></span><br><span class="line">t(&#123;</span><br><span class="line">  name: &#123;<span class="attr">first</span>: <span class="string">'mary'</span>&#125;,</span><br><span class="line">  occupation: <span class="string">'driver'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// &#123;firstName: 'Mary', job: 'driver'&#125;</span></span><br></pre></td></tr></table></figure>
<p>All thanks to lenses.</p>
<h2><span id="links">Links</span></h2><ul>
<li>Ramda lenses <a href="http://ramdajs.com/docs/#lens" target="_blank" rel="noopener">R.lens</a></li>
<li><a href="https://egghead.io/lessons/javascript-change-object-properties-with-ramda-lenses" target="_blank" rel="noopener">Change Object Properties with Ramda Lenses</a></li>
<li><a href="http://randycoulman.com/blog/2016/07/12/thinking-in-ramda-lenses/" target="_blank" rel="noopener">Thinking in Ramda: Lenses</a></li>
<li><a href="https://github.com/bahmutov/change-by-example" target="_blank" rel="noopener">change-by-example</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  var s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/lenses/" data-id="cjestfk0i00gzx2oo429yo51o" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/lenses/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/functional/">functional</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../linters-gonna-lint/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Linters Gonna Lint
        
      </div>
    </a>
  
  
    <a href="../mocking-vs-refactoring/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Mocking vs Refactoring</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">101</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">278</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">97</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">67</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">71</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">71</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.82px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.55px;">advice</a> <a href="../tags/angularjs/" style="font-size: 18.18px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.64px;">assertions</a> <a href="../tags/ast/" style="font-size: 13.18px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.91px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.82px;">browser</a> <a href="../tags/ci/" style="font-size: 12.73px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.73px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 14.09px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.91px;">d3</a> <a href="../tags/db/" style="font-size: 14.09px;">db</a> <a href="../tags/docker/" style="font-size: 13.64px;">docker</a> <a href="../tags/es6/" style="font-size: 15.45px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.64px;">functional</a> <a href="../tags/generators/" style="font-size: 11.82px;">generators</a> <a href="../tags/git/" style="font-size: 14.55px;">git</a> <a href="../tags/grunt/" style="font-size: 12.73px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.91px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 11.82px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.36px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.91px;">interview</a> <a href="../tags/jade/" style="font-size: 11.36px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.91px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 17.27px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 19.09px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.36px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.36px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.73px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.45px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 15px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.45px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.73px;">security</a> <a href="../tags/sentry/" style="font-size: 14.09px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.27px;">service workers</a> <a href="../tags/testing/" style="font-size: 19.09px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.18px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.45px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.45px;">ui</a> <a href="../tags/vuejs/" style="font-size: 10.91px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.27px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../renovate-app/">Painless Dependency Upgrades with Renovate App</a>
          </li>
        
          <li>
            <a href="../debugging-mocha-using-inspector/">Debugging Mocha from Node using Chrome Inspector</a>
          </li>
        
          <li>
            <a href="../subfolders-as-dependencies/">Subfolders as Dependencies</a>
          </li>
        
          <li>
            <a href="../parcel/">Parcel Bundler</a>
          </li>
        
          <li>
            <a href="../use-lenses-in-hyperapp/">Use Lenses in Hyperapp</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/lenses/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
