<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cypress tips and tricks | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="We have been successfully using Cypress to verify our websites and web apps for a while. Here are some tips &amp;amp; tricks we have learned. Even this blog is tested using Cypress :) Read the docsCypress">
<meta name="keywords" content="testing,cypress">
<meta property="og:type" content="article">
<meta property="og:title" content="Cypress tips and tricks">
<meta property="og:url" content="https://glebbahmutov.com/blog/cypress-tips-and-tricks/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="We have been successfully using Cypress to verify our websites and web apps for a while. Here are some tips &amp;amp; tricks we have learned. Even this blog is tested using Cypress :) Read the docsCypress">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/cypress-breadcrumbs.png">
<meta property="og:updated_time" content="2018-02-14T02:33:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cypress tips and tricks">
<meta name="twitter:description" content="We have been successfully using Cypress to verify our websites and web apps for a while. Here are some tips &amp;amp; tricks we have learned. Even this blog is tested using Cypress :) Read the docsCypress">
<meta name="twitter:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <!-- <div id="banner"></div> -->
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../index.html" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="../index.html" id="subtitle">Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <!-- <span class="no-mobile">Software advice from</span> -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">
          <a id="subtitle" href="http://glebbahmutov.com">Gleb Bahmutov PhD</a>
        </span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-cypress-tips-and-tricks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2016-12-30T05:00:00.000Z" itemprop="datePublished">Dec 30 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cypress tips and tricks
    </h1>

    <h2 class="article-title" itemprop="name">
      A few tips on getting the most out of E2E testing tool Cypress
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We have been successfully using Cypress to verify our websites and
web apps for a while. Here are some tips &amp; tricks we have learned.</p>
<p>Even this blog is tested using Cypress :)</p>
<h2><span id="read-the-docs">Read the docs</span></h2><p><a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a> has excellent documentation at
<a href="https://docs.cypress.io/" target="_blank" rel="noopener">https://docs.cypress.io/</a>, including
<a href="https://docs.cypress.io/docs/all-example-apps" target="_blank" rel="noopener">examples</a>,
<a href="https://docs.cypress.io/docs" target="_blank" rel="noopener">guides</a>,
<a href="https://www.cypress.io/explore/" target="_blank" rel="noopener">videos</a> and even a busy
<a href="https://gitter.im/cypress-io/cypress" target="_blank" rel="noopener">Gitter chat channel</a>.
There is also &quot;Search&quot; box that quickly finds relevant documents.
Recently common recipes were combined into a
<a href="https://github.com/cypress-io/cypress-example-recipes" target="_blank" rel="noopener">single place</a>.
If you still have an issue with Cypress, please search through open and
closed <a href="https://github.com/cypress-io/cypress/issues" target="_blank" rel="noopener">issues</a>.</p>
<p>You can also read my other blog posts about Cypress under
<a href="../tags/cypress/">tags/cypress</a>.</p>
<h2><span id="run-cypress-on-your-own-ci">Run Cypress on your own CI</span></h2><p>As long as the project has a project key, you can run the tests on your
own <a href="https://docs.cypress.io/docs/continuous-integration" target="_blank" rel="noopener">CI boxes</a>.
I found running inside Docker to be the easiest, and even built an
<a href="https://hub.docker.com/r/bahmutov/cypress-image/" target="_blank" rel="noopener">unofficial Docker image</a>
with all dependencies.</p>
<p>Note that <code>cypress ci ...</code> will upload recorded videos and screenshots
(if capturing them is <a href="https://docs.cypress.io/docs/configuration#section-screenshots" target="_blank" rel="noopener">enabled</a>)
to the Cypress cloud, while <code>cypress run ...</code> will not.</p>
<h2><span id="record-success-and-failure-videos">Record success and failure videos</span></h2><p>When Cypress team has released the video capture feature in version
<a href="https://github.com/cypress-io/cypress/wiki/changelog#01711-11162016" target="_blank" rel="noopener">0.17.11</a>
it quickly became my favorite. I have configured our
<a href="https://about.gitlab.com/gitlab-ci/" target="_blank" rel="noopener">GitLab CI</a> to keep artifacts from
failed test runs for 1 week, while keeping videos from successful
test runs only for a 3 days.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">on_failure</span></span><br><span class="line"><span class="attr">  expire_in:</span> <span class="string">'1 week'</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cypress/videos</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cypress/screenshots</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="attr">  when:</span> <span class="string">on_success</span></span><br><span class="line"><span class="attr">  expire_in:</span> <span class="string">'3 days'</span></span><br><span class="line"><span class="attr">  untracked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">cypress/screenshots</span></span><br></pre></td></tr></table></figure>
<p>Whenever a test fails, I watch the failure video side by side with the video
from the last successful test run. The differences in the subject under test
are quickly obvious.</p>
<h2><span id="move-common-code-into-utility-package">Move common code into utility package</span></h2><p>Testing code should be engineered as well as the production code.
To avoid duplicating testing helper utilities, we advise to move all common
helpers into their own NPM module. For example, we use local CSS styles
with randomized class names in our web code.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"table-1b4a2 people-5ee98"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>This makes the selectors very long since we need to use prefixes.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">'[class*=people-]'</span>) <span class="comment">// UGLY!</span></span><br></pre></td></tr></table></figure>
<p>By creating a tiny helper function we alleviated the selector head aches.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;classPrefix&#125; <span class="keyword">from</span> <span class="string">'@team/cypress-utils/css-names'</span></span><br><span class="line"><span class="comment">// classPrefix('foo') returns "[class*=foo-]"</span></span><br><span class="line">cy.get(classPrefix(<span class="string">'people'</span>))</span><br></pre></td></tr></table></figure>
<p>The test code became a lot more readable.</p>
<h2><span id="separate-tests-into-bundles">Separate tests into bundles</span></h2><p>Using a single <code>cypress/integration/spec.js</code> file to test a large web
application quickly becomes difficult and time consuming. We have separated
our code into multiple files. Additionally, we keep the source files
in <code>src</code> folder and build the multiple bundles in <code>cypress/integration</code>
using <a href="https://github.com/kensho/multi-cypress" target="_blank" rel="noopener">kensho/multi-cypress</a> tool.</p>
<p>The <code>multi-cypress</code> tool assumes that Docker and GitLab CI are used to
actually run the tests. Each test will be inside its own &quot;test job&quot;, thus
10 spec files can be executed at once (assuming at least 10 GitLab CI
runners are available).</p>
<p>The command to run a specific spec file is
<code>cypress run --spec &quot;spec/filename.js&quot;</code> by the way.</p>
<h2><span id="make-javascript-crashes-useful">Make JavaScript crashes useful</span></h2><p>As I have said before, the true value of a test is not when it passes,
but when it fails. Additionally, even a passing test might generate
client-side errors that are not crashes and do not fail the test.
For example, we often use <a href="https://sentry.io/" target="_blank" rel="noopener">Sentry</a> exception monitoring
service where we forward all client-side errors.</p>
<p>If a client-side error happens while the E2E Cypress test is running,
we need this additional context: which test is executing, what steps were
already finished before the error was reported, etc.</p>
<p>By loading a small library
<a href="https://github.com/bahmutov/send-test-info" target="_blank" rel="noopener">send-test-info</a> before each
test, we can capture the name of the test, its spec filename and even
the Cypress test log as breadcrumbs; this information is then sent to Sentry
with each crash. For example, the exception below shows the name of the
test when the error was reported</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png" alt="Test name"></p>
<p>Similarly, the Cypress test steps are logged as breadcrumbs and are sent
with the exception allowing any developer to quickly get a sense when the
error happens as the test runs.</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/cypress-breadcrumbs.png" alt="Test steps"></p>
<h2><span id="use-test-names-when-creating-data">Use test names when creating data</span></h2><p>Often as part of the E2E test we create items / users / posts. I like to
put the full test title in the created data to easily see what test created
which datum. Inside the test we can quickly grab the full title
(which includes the full parent&#39;s title and the current test name)
from the context.</p>
<p>I also like creating random numbers for additional difference</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uuid = <span class="function"><span class="params">()</span> =&gt;</span> Cypress._.random(<span class="number">0</span>, <span class="number">1e6</span>)</span><br><span class="line">describe(<span class="string">'foo'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// note that we need to use "function" and not fat arrow</span></span><br><span class="line">  <span class="comment">// to actually get the right "this" context</span></span><br><span class="line">  it(<span class="string">'bar'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = uuid()</span><br><span class="line">    <span class="keyword">const</span> testName = <span class="keyword">this</span>.test.fullTitle()</span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">`test name: <span class="subst">$&#123;testName&#125;</span> - <span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    <span class="comment">// name will be "test name: foo bar - &lt;random&gt;"</span></span><br><span class="line">    makeItem(&#123;name&#125;) <span class="comment">// use the test name to create unique item</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="explore-the-environment">Explore the environment</span></h2><p>You can pause the test execution by using <code>debugger</code> keyword. Make sure
the DevTools are open!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'bar'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="comment">// explore "this" context</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="run-all-spec-files-locally">Run all spec files locally</span></h2><p>If you separate <a href="https://www.cypress.io/" target="_blank" rel="noopener">Cypress</a>
E2E tests into multiple spec files, you soon end up with lots of files.
If you need to run the scripts one by one from the command line,
I wrote a small utility
<a href="https://github.com/bahmutov/run-each-cypress-spec" target="_blank" rel="noopener">run-each-cypress-spec</a>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install -g run-each-cypress-spec</span><br><span class="line">run-specs</span><br><span class="line">...</span><br><span class="line">running cypress/integration/a-spec.js</span><br><span class="line">Started video recording: /Users/gleb/cypress/videos/p259n.mp4</span><br><span class="line">...</span><br><span class="line">running cypress/integration/b-spec.js</span><br><span class="line">Started video recording: /Users/gleb/cypress/videos/62er1.mp4</span><br></pre></td></tr></table></figure>
<p>If you need environment variables (like urls, passwords), you can easily
inject them using <a href="https://github.com/bahmutov/as-a" target="_blank" rel="noopener">as-a</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as<span class="_">-a</span> cy run-specs</span><br></pre></td></tr></table></figure>
<h2><span id="get-command-log-on-failure">Get command log on failure</span></h2><p>While videos of the failed tests are useful, sometimes we just want to get
a sense of the failure before triaging it. In the headless CI mode, you can
get a JSON file for each failed test with the log of all commands. See
the JSON file below as an example of a failed test and the file it generated.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"testName"</span>: <span class="string">"Website loads the About tab"</span>,</span><br><span class="line">  <span class="attr">"testError"</span>: <span class="string">"Timed out retrying: Expected to find content: 'Join Us' but never did."</span>,</span><br><span class="line">  <span class="attr">"testCommands"</span>: [</span><br><span class="line">    <span class="string">"visit"</span>,</span><br><span class="line">    <span class="string">"new url https://www.company.com/#/"</span>,</span><br><span class="line">    <span class="string">"contains a.nav-link, About"</span>,</span><br><span class="line">    <span class="string">"click"</span>,</span><br><span class="line">    <span class="string">"new url https://www.company.com/#/about"</span>,</span><br><span class="line">    <span class="string">"hash"</span>,</span><br><span class="line">    <span class="string">"assert expected **#/about** to equal **#/about**"</span>,</span><br><span class="line">    <span class="string">"contains Join Us"</span>,</span><br><span class="line">    <span class="string">"assert expected **body :not(script):contains(**'Join Us'**),</span></span><br><span class="line"><span class="string">      [type='submit'][value~='Join Us']** to exist in the DOM"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a separate project that just needs to be included from your
<code>cypress/support/index.js</code> file. For instructions see
<a href="https://github.com/bahmutov/cypress-failed-log" target="_blank" rel="noopener">cypress-failed-log</a> project.</p>
<h2><span id="wait-on-the-right-thing">Wait on the right thing</span></h2><p>It is important to wait for the right element. Imagine we have a list of items
in the DOM. We expect a new element to appear with text &quot;Hello&quot;. We could
select first the list, then the element containing &quot;Hello&quot; and check if it
becomes visible</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">'.list'</span>)</span><br><span class="line">  .contains(<span class="string">'li'</span>, <span class="string">'Hello'</span>)</span><br><span class="line">  .should(<span class="string">'be.visible'</span>)</span><br><span class="line"></span><br><span class="line">But sometimes it does not work. When we <span class="string">`cy.get('.list')`</span> Cypress saves the</span><br><span class="line">DOM element <span class="keyword">as</span> the <span class="string">"subject"</span> and then tries to wait <span class="keyword">for</span> a child <span class="keyword">of</span> that</span><br><span class="line">element <span class="keyword">with</span> text <span class="string">"Hello"</span> to become visible. If we use React <span class="keyword">for</span> example, the</span><br><span class="line">DOM <span class="keyword">of</span> the list might be recreated <span class="keyword">from</span> scratch <span class="keyword">if</span> we push a <span class="keyword">new</span> item into</span><br><span class="line">the list. When that happens Cypress notices that the <span class="string">"subject"</span> DOM it holds</span><br><span class="line">a reference to becomes <span class="string">"detached from the DOM"</span> - it becomes an orphan!</span><br><span class="line"></span><br><span class="line">A better solution to <span class="keyword">this</span> problem is to use a composite CSS selector that</span><br><span class="line">will grab the list AND the item <span class="keyword">in</span> a single operation.</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`js</span></span><br><span class="line"><span class="string">cy.contains('.list li', 'Hello')</span></span><br><span class="line"><span class="string">  .should('be.visible')</span></span><br></pre></td></tr></table></figure>
<p>This forces Cypress to wait for the list AND list item element without caching
a reference to the DOM element <code>.list</code>.
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">You can use advanced CSS selectors to get an element in a single command.</span><br><span class="line">For example instead of `cy.get(&apos;.something&apos;).first()` you could</span><br><span class="line">use `cy.get(&apos;.something:first-child&apos;)`. Similarly,</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">// get first element</span><br><span class="line">cy.get(&apos;.something&apos;).first()</span><br><span class="line">cy.get(&apos;.something:first-child&apos;)</span><br><span class="line">// get last element</span><br><span class="line">cy.get(&apos;.something&apos;).last()</span><br><span class="line">cy.get(&apos;.something:last-child&apos;)</span><br><span class="line">// get second element</span><br><span class="line">cy.get(&apos;.something&apos;).eq(1)</span><br><span class="line">cy.get(&apos;.something:nth-child(2)&apos;)</span><br></pre></td></tr></table></figure></p>
<h2><span id="write-and-read-files">Write and read files</span></h2><p>You can write files to disk directly from Cypress using
<a href="https://docs.cypress.io/v1.0/docs/writefile" target="_blank" rel="noopener">cy.writeFile</a> and read an
<em>existing</em> file using <a href="https://docs.cypress.io/v1.0/docs/readfile" target="_blank" rel="noopener">cy.readFile</a>.
What if you want to read a file that might not exist? <code>cy.readFile</code> will fail
the test if file does not exist, thus we need to find a work around.</p>
<p>In my case, the file I would like to load is a JSON of
<a href="https://github.com/bahmutov/snap-shot" target="_blank" rel="noopener">test values</a>
useful for <a href="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html" target="_blank" rel="noopener">Jest-like snapshot testing</a>.</p>
<p>Here is a neat trick. Save the file using <code>cy.writeFile</code>, for example
<code>cy.writeFile(&#39;spanshots.json&#39;)</code> whenever there is something to save.
When reading the file, <em>fetch it through the Cypress code proxy</em> using <code>fetch</code>
Notice how the test spec itself is served by Cypress from URL which looks like
<code>http://localhost:49829/__cypress/tests?p=cypress/integration/spec.js-438</code>.
Let us &quot;hack&quot; it to load a file that might not exist.</p>
<p>The code below tries to load snapshots file before each test.
If the <code>fetch</code> call fails, the file does not exist.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> snapshots</span><br><span class="line">beforeEach(<span class="function"><span class="keyword">function</span> <span class="title">loadSnapshots</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">'/__cypress/tests?p=./snapshots.json'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">r</span> =&gt;</span> r.text())</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> <span class="title">loadedText</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ?</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">'snapshots file does not exist'</span>)</span><br><span class="line">      snapshots = &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>If the <code>fetch</code> call succeeds, the returned <code>text</code> will NOT be original JSON!
Instead it will be webpacked module :)</p>
<p>For example, here is the saved file</p>
<figure class="highlight json"><figcaption><span>snapshots.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"spec.js"</span>: &#123;</span><br><span class="line">    <span class="attr">"works"</span>: [</span><br><span class="line">      <span class="string">"foo"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is how built-in Cypress bundler returns it in response to
<code>/__cypress/tests?p=./snapshots.json</code> - I have shortened the webpack
boilerplate preamble.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params">t,n,r</span>)</span>&#123;<span class="function"><span class="keyword">function</span> ...)(<span class="params">&#123;<span class="number">1</span>:[function(require,module,exports</span>)</span>&#123;</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">  <span class="string">"spec.js"</span>: &#123;</span><br><span class="line">    <span class="string">"works"</span>: [</span><br><span class="line">      <span class="string">"foo"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,&#123;&#125;]&#125;,&#123;&#125;,[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<p>Notice that our JSON has been placed into module with id &#39;1&#39; (first line
expression <code>{1:</code>). The entire bundle registers a stand alone <code>require</code>
function. If we want to get into the actual &quot;module&quot; contents we have to
do the following in our <code>function loadedText(text)</code> to finish the hack</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadedText</span> (<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (text.includes(<span class="string">'BUNDLE_ERROR'</span>)) &#123;</span><br><span class="line">    <span class="comment">// if the bundler tried to handle missing file</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'not found'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> req = <span class="built_in">eval</span>(text)</span><br><span class="line">  snapshots = req(<span class="string">'1'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Boom, the object <code>snapshots</code> has been loaded from the file <code>snapshots.json</code>
which might or might not exist.</p>
<p><strong>Note</strong> while I have successfully used the above hack when running Cypress
locally, it was always failing when doing <code>cypress run</code> in headless mode.</p>
<h2><span id="conditional-logic">Conditional logic</span></h2><p>Sometimes you might need to interact with a page element that does not always
exist. For example there might a modal dialog the first time you use the
website. You want to close the modal dialog.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">'.greeting'</span>)</span><br><span class="line">  .contains(<span class="string">'Close'</span>)</span><br><span class="line">  .click()</span><br><span class="line">cy.get(<span class="string">'.greeting'</span>)</span><br><span class="line">  .should(<span class="string">'not.be.visible'</span>)</span><br></pre></td></tr></table></figure>
<p>But the modal is not shown the second time around and the above code will
fail. In order to check if an element exists without asserting it, use
the proxied jQuery function
<a href="https://docs.cypress.io/v1.0/docs/cypress-jquery" target="_blank" rel="noopener">Cypress.$</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $el = Cypress.$(<span class="string">'.greeting'</span>)</span><br><span class="line"><span class="keyword">if</span> ($el.length) &#123;</span><br><span class="line">  cy.log(<span class="string">'Closing greeting'</span>)</span><br><span class="line">  cy.get(<span class="string">'.greeting'</span>)</span><br><span class="line">    .contains(<span class="string">'Close'</span>)</span><br><span class="line">    .click()</span><br><span class="line">&#125;</span><br><span class="line">cy.get(<span class="string">'.greeting'</span>)</span><br><span class="line">  .should(<span class="string">'not.be.visible'</span>)</span><br></pre></td></tr></table></figure>
<p>The above check is safe.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  var s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/cypress-tips-and-tricks/" data-id="cjf5fgbra007izlooso95me3a" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/cypress-tips-and-tricks/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../server-push-on-dokku/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          HTTP/2 server push on Dokku
        
      </div>
    </a>
  
  
    <a href="../functors-encapsulate-imperative-logic/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Functors encapsulate imperative logic</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">102</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">278</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">98</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/">ci</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/">cypress</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/">docker</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">67</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/">hyperapp</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">71</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/">presentation</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">71</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/">typescript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/">vuejs</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">6</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 11.82px;">QUnit</a> <a href="../tags/advice/" style="font-size: 19.55px;">advice</a> <a href="../tags/angularjs/" style="font-size: 18.18px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.64px;">assertions</a> <a href="../tags/ast/" style="font-size: 13.18px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15.91px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 16.82px;">browser</a> <a href="../tags/ci/" style="font-size: 12.73px;">ci</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.73px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 14.09px;">cypress</a> <a href="../tags/d3/" style="font-size: 10.91px;">d3</a> <a href="../tags/db/" style="font-size: 14.09px;">db</a> <a href="../tags/docker/" style="font-size: 13.64px;">docker</a> <a href="../tags/es6/" style="font-size: 15.45px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.64px;">functional</a> <a href="../tags/generators/" style="font-size: 11.82px;">generators</a> <a href="../tags/git/" style="font-size: 14.55px;">git</a> <a href="../tags/grunt/" style="font-size: 12.73px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.91px;">gulp</a> <a href="../tags/hyperapp/" style="font-size: 11.82px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.36px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.91px;">interview</a> <a href="../tags/jade/" style="font-size: 11.36px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.91px;">jshint</a> <a href="../tags/modular-development/" style="font-size: 17.27px;">modular development</a> <a href="../tags/nodejs/" style="font-size: 19.09px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.36px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.36px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.73px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.45px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/reactive/" style="font-size: 15px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 10.45px;">reactjs</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.73px;">security</a> <a href="../tags/sentry/" style="font-size: 14.09px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 12.27px;">service workers</a> <a href="../tags/testing/" style="font-size: 19.09px;">testing</a> <a href="../tags/tutorial/" style="font-size: 13.18px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 10.45px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.45px;">ui</a> <a href="../tags/vuejs/" style="font-size: 10.91px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 12.27px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../how-i-organize-readme/">How I Organize README</a>
          </li>
        
          <li>
            <a href="../renovate-app/">Painless Dependency Upgrades with Renovate App</a>
          </li>
        
          <li>
            <a href="../debugging-mocha-using-inspector/">Debugging Mocha from Node using Chrome Inspector</a>
          </li>
        
          <li>
            <a href="../subfolders-as-dependencies/">Subfolders as Dependencies</a>
          </li>
        
          <li>
            <a href="../parcel/">Parcel Bundler</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/cypress-tips-and-tricks/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css">
  <script src="../fancybox/jquery.fancybox.pack.js"></script>


<script src="../js/script.js"></script>

  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
